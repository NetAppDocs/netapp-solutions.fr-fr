---
sidebar: sidebar 
permalink: ehc/aws/aws-guest-dr-snapcenter-db-backup.html 
keywords: SnapCenter backup, restore process, Swagger, authorization token, NFS, CIFS, file share, XCOPY utility 
summary: 'SnapCenter permet la sauvegarde et la récupération de sa base de données MySQL sous-jacente et des données de configuration afin de restaurer le serveur SnapCenter en cas d"incident. Pour notre solution, nous avons restauré la base de données et la configuration d"SnapCenter sur une instance EC2 AWS résidant sur notre VPC.' 
---
= Sauvegarde des bases de données SnapCenter pour la reprise après incident
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../../media/


link:aws-guest-dr-cloud-backup-config.html["Précédent : outils et configuration de sauvegarde dans le cloud."]

SnapCenter permet la sauvegarde et la récupération de sa base de données MySQL sous-jacente et des données de configuration afin de restaurer le serveur SnapCenter en cas d'incident. Pour notre solution, nous avons restauré la base de données et la configuration d'SnapCenter sur une instance EC2 AWS résidant sur notre VPC. Pour plus d'informations sur cette étape, reportez-vous à la section https://docs.netapp.com/us-en/snapcenter/sc-automation/rest_api_workflows_disaster_recovery_of_snapcenter_server.html["ce lien"^].



== Conditions préalables à la sauvegarde SnapCenter

Les prérequis suivants sont requis pour la sauvegarde SnapCenter :

* Un partage de volume et SMB créé sur le système ONTAP sur site pour localiser la base de données et les fichiers de configuration sauvegardés.
* Relation SnapMirror entre le système ONTAP sur site et FSX ou CVO dans le compte AWS. Cette relation est utilisée pour le transport de l'instantané contenant la base de données SnapCenter sauvegardée et les fichiers de configuration.
* Windows Server installé dans le compte cloud, soit sur une instance EC2, soit sur une VM dans le SDDC VMware Cloud.
* SnapCenter installé sur l'instance Windows EC2 ou le VM dans VMware Cloud.




== Récapitulatif du processus de sauvegarde et de restauration SnapCenter

* Créez un volume sur le système ONTAP sur site pour héberger les fichiers de base de données de sauvegarde et de configuration.
* Configurer une relation SnapMirror entre le site et FSX/CVO.
* Montez le partage SMB.
* Récupérez le jeton d'autorisation de swagger pour effectuer des tâches API.
* Démarrez le processus de restauration de la base de données.
* Utilisez l'utilitaire xcopy pour copier le répertoire local du fichier de base de données et de configuration dans le partage SMB.
* Sur la plateforme FSX, créez un clone du volume ONTAP (copié via SnapMirror depuis sur site).
* Montez le partage SMB de FSX vers le cloud EC2/VMware.
* Copiez le répertoire de restauration du partage SMB dans un répertoire local.
* Exécutez le processus de restauration de SQL Server à partir de swagger.




== Sauvegarder la base de données et la configuration de SnapCenter

SnapCenter fournit une interface client Web pour l'exécution des commandes de l'API REST. Pour plus d'informations sur l'accès aux API REST via swagger, consultez la documentation SnapCenter à l'adresse https://docs.netapp.com/us-en/snapcenter/sc-automation/overview_rest_apis.html["ce lien"^].



=== Connectez-vous à swagger et obtenez le jeton d'autorisation

Une fois que vous avez navigué vers la page swagger, vous devez récupérer un jeton d'autorisation pour lancer le processus de restauration de la base de données.

. Accédez à la page Web de l'API SnapCenter swagger à l'adresse _\https://<SnapCenter Server IP>:8146/swagger/_.
+
image:dr-vmc-aws-image40.png["Erreur : image graphique manquante"]

. Développez la section Auth et cliquez sur le bouton essayer.
+
image:dr-vmc-aws-image41.png["Erreur : image graphique manquante"]

. Dans la zone UserOperationContext, renseignez les informations d'identification et le rôle SnapCenter, puis cliquez sur Exécuter.
+
image:dr-vmc-aws-image42.png["Erreur : image graphique manquante"]

. Dans le corps de réponse ci-dessous, vous pouvez voir le jeton. Copiez le texte du token pour l'authentification lors de l'exécution du processus de sauvegarde.
+
image:dr-vmc-aws-image43.png["Erreur : image graphique manquante"]





=== Effectuez une sauvegarde de base de données SnapCenter

Passez ensuite à la zone de reprise sur incident de la page swagger pour lancer le processus de sauvegarde SnapCenter.

. Développez la zone de reprise après sinistre en cliquant dessus.
+
image:dr-vmc-aws-image44.png["Erreur : image graphique manquante"]

. Développez le `/4.6/disasterrecovery/server/backup` Et cliquez sur essayer.
+
image:dr-vmc-aws-image45.png["Erreur : image graphique manquante"]

. Dans la section SmDRBackupRequest, ajoutez le chemin cible local correct et sélectionnez Exécuter pour lancer la sauvegarde de la base de données et de la configuration SnapCenter.
+

NOTE: Le processus de sauvegarde ne permet pas de sauvegarder directement les données sur un partage de fichiers NFS ou CIFS.

+
image:dr-vmc-aws-image46.png["Erreur : image graphique manquante"]





=== Surveillez la procédure de sauvegarde depuis SnapCenter

Connectez-vous à SnapCenter pour consulter les fichiers journaux au démarrage du processus de restauration de la base de données. Dans la section moniteur, vous pouvez afficher les détails de la sauvegarde de reprise après incident du serveur SnapCenter.

image:dr-vmc-aws-image47.png["Erreur : image graphique manquante"]



=== Utilisez l'utilitaire XCOPY pour copier le fichier de sauvegarde de la base de données dans le partage SMB

Vous devez ensuite déplacer la sauvegarde du disque local du serveur SnapCenter vers le partage CIFS utilisé pour copier les données dans l'emplacement secondaire situé sur l'instance FSX d'AWS. Utilisez xcopy avec des options spécifiques qui conservent les autorisations des fichiers.

Ouvrez une invite de commande en tant qu'administrateur. Dans l'invite de commande, entrez les commandes suivantes :

....
xcopy  <Source_Path>  \\<Destination_Server_IP>\<Folder_Path> /O /X /E /H /K
xcopy c:\SC_Backups\SnapCenter_DR \\10.61.181.185\snapcenter_dr /O /X /E /H /K
....
link:aws-guest-dr-failover.html["Suivant : le basculement."]
