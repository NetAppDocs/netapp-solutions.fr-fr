---
sidebar: sidebar 
permalink: databases/vcf_ora_si_vvol.html 
keywords: Database, Oracle, AWS, FSx ONTAP, VMC, VMware 
summary: 'La solution offre une vue d"ensemble et des informations détaillées sur le déploiement et la protection d"Oracle dans VMware Cloud Foundation (VCF) avec les volumes virtuels vSphere (vVols) en tant que stockage de base de données primaire et la base de données Oracle dans une configuration à instance unique (si).' 
---
= Tr-4996 : déploiement et protection d'Oracle si dans VCF avec vVols
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


Allen Cao, Niyaz Mohamed, NetApp

[role="lead"]
La solution offre une vue d'ensemble et des informations détaillées sur le déploiement et la protection d'Oracle dans VMware Cloud Foundation (VCF) avec les volumes virtuels vSphere (vVols) en tant que stockage de base de données primaire et la base de données Oracle dans une configuration à instance unique (si).



== Objectif

VMware vSphere Virtual volumes (vVols) est un framework de gestion et d'intégration SAN/NAS qui expose les disques virtuels en tant qu'objets de stockage natifs et permet des opérations basées sur les baies au niveau du disque virtuel. En d'autres termes, les vVols permettent aux périphériques SAN/NAS de prendre en charge les machines virtuelles et libèrent la possibilité d'exploiter des services de données basés sur les baies grâce à une approche axée sur les machines virtuelles, au niveau de la granularité d'un seul disque virtuel. VVols permet aux clients de tirer parti des capacités uniques de leurs investissements actuels en matière de stockage et de passer sans interruption à un modèle opérationnel plus simple et plus efficace, optimisé pour les environnements virtuels fonctionnant sur tous les types de stockage.

Ce document démontre le déploiement et la protection d'une base de données à instance unique Oracle dans un environnement VMware Cloud Foundation avec vVols comme stockage de base de données primaire dans un cluster de stockage NetApp ONTAP. La base de données Oracle est configurée comme si elle était déployée dans des systèmes de fichiers locaux sur un système de stockage local. Ce rapport technique porte sur les étapes de création de vVols dans VCF pour le déploiement d'Oracle. Nous démontrons également comment utiliser l'outil d'interface utilisateur NetApp SnapCenter pour sauvegarder, restaurer et cloner une base de données Oracle à des fins de développement/test ou pour d'autres cas d'utilisation dans le cadre d'opérations de base de données efficaces en termes de stockage dans VCF.

Cette solution répond aux cas d'utilisation suivants :

* Déploiement de la base de données si Oracle dans VCF avec le datastore vVols sur NetApp ONTAP AFF en tant que stockage de base de données primaire
* Sauvegarde et restauration de bases de données Oracle dans VCF avec datastore vVols à l'aide de l'outil d'interface utilisateur NetApp SnapCenter
* Clone de la base de données Oracle pour le développement/test ou autres utilisations dans VCF avec le datastore vVols à l'aide de l'outil d'interface utilisateur NetApp SnapCenter




== Public

Cette solution est destinée aux personnes suivantes :

* Administrateur de base de données qui souhaite déployer Oracle dans VCF avec le datastore vVols sur NetApp ONTAP AFF en tant que stockage de base de données primaire
* Architecte de solutions de bases de données qui souhaite tester les workloads Oracle dans VCF avec un datastore vVols sur stockage NetApp ONTAP AFF
* Administrateur du stockage qui souhaite déployer et gérer une base de données Oracle déployée dans VCF avec un datastore vVols sur un système de stockage NetApp ONTAP AFF
* Propriétaire d'application qui souhaite créer une base de données Oracle dans VCF avec un datastore vVol




== Environnement de test et de validation de la solution

Les tests et la validation de cette solution ont été réalisés dans un environnement de laboratoire avec VCF et le datastore vVols sur du stockage NetApp ONTAP AFF qui ne correspond peut-être pas à l'environnement de déploiement final. Pour plus d'informations, reportez-vous à la section <<Facteurs clés à prendre en compte lors du déploiement>>.



=== Architecture

image::vcf_ora_si_vvols_architecture.png[Cette image fournit une vue détaillée de la configuration du déploiement Oracle dans le cloud public AWS avec iSCSI et ASM.]



=== Composants matériels et logiciels

[cols="33%, 33%, 33%"]
|===


3+| *Matériel* 


| NetApp ONTAP AFF A300 | Version 9.14.1P4 | Tiroir DS224 avec 24 disques NVMe, capacité totale de 35.2 Tio 


| Cluster VMware vSphere | Version 8.02 | 12 processeurs x Intel(R) Xeon(R) Gold 5218 à 2,30 GHz, 8 nœuds (4 domaines de gestion et 4 domaines de charge de travail) 


3+| *Logiciel* 


| Red Hat Linux | Noyau RHEL-8.6, 4.18.0-372.9.1.el8.x86_64 | Hébergement des serveurs de base de données Oracle, déploiement de l'abonnement RedHat pour le test 


| Serveur Windows | 2022 Standard, 10.0.20348 année de construction 20348 | Hébergement du serveur SnapCenter 


| CentOS Linux | CentOS Linux version 8.5.2111 | Hébergement du contrôleur Ansible 


| Base de données Oracle | Version 19.18 | Patch RU appliqué p34765931_190000_Linux-x86-64.zip 


| OPICH Oracle | Version 12.2.0.1.36 | Dernier correctif p6880880_190000_Linux-x86-64.zip 


| Serveur SnapCenter | Version 6.0 | Déploiement de groupes de travail 


| Plug-in SnapCenter pour VMware vSphere | Version 6.0 | Déployée en tant que machine virtuelle ova dans le cluster vSphere 


| Outil ONTAP pour VMware vSphere | Version 9.13 | Déployée en tant que machine virtuelle ova dans le cluster vSphere 


| Ouvrez JDK | Version Java-11-openjdk-11.0.23.0.9-3.el8.x86_64 | Plug-in SnapCenter requis sur les VM de base de données 
|===


=== Configuration de la base de données Oracle dans VCF

[cols="33%, 33%, 33%"]
|===


3+|  


| *Serveur* | *Base de données* | *Stockage DB* 


| ora_01 | NTAP1(NTAP1_pdb1,NTAP1_pdb2,NTAP1_pdb3) | Datastores vVols sur NetApp ONTAP AFF A300 


| ora_02 | NTAP2(NTAP2_pdb1,NTAP2_pdb2,NTAP2_pdb3), NTAP1CLN | Datastores vVols sur NetApp ONTAP AFF A300 
|===


=== Facteurs clés à prendre en compte lors du déploiement

* *Protocole pour vVols à la connectivité du cluster ONTAP.* NFS ou iSCSI sont un bon choix. Les niveaux de performances sont équivalents. Dans cette démonstration de solution, nous avons utilisé NFS comme protocole de stockage pour la connectivité vVols vers le cluster de stockage ONTAP souligné. Si l'infrastructure VCF est prise en charge, les protocoles FC/FCoE, NVMe/FC sont également pris en charge pour les datastores vVols sur NetApp ONTAP.
* *Disposition du stockage Oracle sur les datastores vVols.* Lors de nos tests et de nos validations, nous avons déployé trois datastores vVols pour les fichiers binaires Oracle, les données Oracle et les fichiers journaux Oracle. Il est recommandé de séparer les différents types de fichiers Oracle dans leur datastore afin de faciliter la gestion et l'exécution de la sauvegarde, de la restauration ou du clone de la base de données. Créez des vVols dédiés aux grandes bases de données et partagez des vVols pour les bases de données plus petites ou avec un profil de QoS similaire. 
* *Informations d'identification pour l'authentification de stockage ONTAP.* Utilisez uniquement les informations d'identification ONTAP au niveau du cluster pour l'authentification du cluster de stockage ONTAP, y compris la connectivité SnapCenter au cluster de stockage ONTAP ou à l'outil ONTAP au cluster de stockage ONTAP.
* *Provisionnement du stockage du datastore vVols sur la machine virtuelle de base de données.* Ajoutez un seul disque à la fois à la machine virtuelle de la base de données à partir du datastore vVols. L'ajout simultané de plusieurs disques à partir des datastores vVols n'est pas pris en charge pour le moment.  
* *Protection de la base de données.* NetApp propose une suite logicielle SnapCenter pour la sauvegarde, la restauration et le clonage de bases de données, via une interface utilisateur conviviale. NetApp recommande de mettre en œuvre cet outil de gestion afin de réaliser rapidement (moins d'une minute) des sauvegardes Snapshot, des restaurations rapides (en minutes) des bases de données et des clones de base de données.




== Déploiement de la solution

Les sections suivantes présentent des procédures détaillées pour le déploiement d'Oracle 19c dans VCF avec des datastores vVols sur stockage NetApp ONTAP dans une configuration d'instance unique Oracle.



=== Conditions préalables au déploiement

[%collapsible]
====
Le déploiement nécessite les conditions préalables suivantes.

. Un VMware VCF a été configuré. Pour plus d'informations ou d'instructions sur la création d'un VCF, reportez-vous à la documentation VMware link:https://docs.vmware.com/en/VMware-Cloud-Foundation/index.html["Documentation de VMware Cloud Foundation"^].
. Provisionnez trois VM Linux, deux VM pour la base de données Oracle et une VM pour le contrôleur Ansible dans le domaine des workloads VCF. Provisionner une machine virtuelle de serveur Windows pour exécuter NetApp SnapCenter Server. Pour plus d'informations sur la configuration du contrôleur Ansible pour le déploiement automatisé de bases de données Oracle, reportez-vous aux ressources suivantes link:https://docs.netapp.com/us-en/netapp-solutions/automation/getting-started.html["Commencer à utiliser l'automatisation des solutions NetApp"^].
. Le plug-in SnapCenter version 6.0 pour VMware vSphere a été déployé dans VCF. Reportez-vous aux ressources suivantes pour le déploiement du plug-in : link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/["Documentation du plug-in SnapCenter pour VMware vSphere"^].
. L'outil ONTAP pour VMware vSphere a été déployé dans VCF. Consultez les ressources suivantes pour l'outil ONTAP de déploiement de VMware vSphere : link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["Documentation sur les outils ONTAP pour VMware vSphere"^]



NOTE: Assurez-vous d'avoir alloué au moins 50G dans le volume racine d'Oracle VM afin de disposer d'un espace suffisant pour préparer les fichiers d'installation d'Oracle.

====


=== Créer un profil de capacité de stockage

[%collapsible]
====
Tout d'abord, créez un profil de capacité de stockage personnalisé pour le stockage ONTAP souligné qui héberge le datastore vVols.

. Dans les raccourcis client vSphere, ouvrez l'outil NetApp ONTAP. Vérifier que le cluster de stockage ONTAP a été ajouté à `Storage Systems` dans le cadre du déploiement de l'outil ONTAP.
+
image:vcf_ora_vvol_scp_01.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."] image:vcf_ora_vvol_scp_00.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]

. Cliquez sur `Storage capability profile` pour ajouter un profil personnalisé pour Oracle. Nommez le profil et ajoutez une brève description.
+
image:vcf_ora_vvol_scp_02.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]

. Choisissez la catégorie de contrôleur de stockage : performances, capacité ou hybride.
+
image:vcf_ora_vvol_scp_03.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]

. Sélectionnez le protocole.
+
image:vcf_ora_vvol_scp_04.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]

. Si nécessaire, définissez une règle de QoS.
+
image:vcf_ora_vvol_scp_05.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]

. Attributs de stockage supplémentaires pour le profil. Assurez-vous que le cryptage est activé sur le contrôleur NetApp si vous souhaitez disposer de la fonction de cryptage ou qu'il peut causer des problèmes lors de l'application du profil.
+
image:vcf_ora_vvol_scp_06.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]

. Vérifiez le récapitulatif et terminez la création du profil de capacité de stockage.
+
image:vcf_ora_vvol_scp_07.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]



====


=== Créer et configurer le datastore vVols

[%collapsible]
====
Une fois les conditions préalables remplies, connectez-vous au VCF en tant qu'utilisateur administrateur via le client vSphere, en accédant au domaine de charge de travail. N'utilisez pas l'option de stockage VMware intégrée pour créer des vVols. Utilisez plutôt l'outil NetApp ONTAP pour créer des vVols. La présente procédure de création et de configuration de vVols est la suivante.

. Le workflow de création des vVols peut être déclenché à partir de l'interface de l'outil ONTAP ou du cluster du domaine de charge de travail VCF.
+
image:vcf_ora_vvol_datastore_01.png["Capture d'écran montrant la configuration du datastore vVols."]

+
image:vcf_ora_vvol_datastore_01_2.png["Capture d'écran montrant la configuration du datastore vVols."]

. Saisie d'informations générales pour le datastore, y compris la destination de provisionnement, le type, le nom et le protocole.
+
image:vcf_ora_vvol_datastore_02.png["Capture d'écran montrant la configuration du datastore vVols."]

. Sélectionnez le profil de capacité de stockage personnalisé créé à partir de l'étape précédente, les `Storage system`, et `Storage VM`, où les vVols doivent être créés.
+
image:vcf_ora_vvol_datastore_03.png["Capture d'écran montrant la configuration du datastore vVols."]

. Choisissez `Create new volumes`, indiquez le nom et la taille du volume et cliquez sur, puis sur `ADD` `NEXT` pour accéder à la page de résumé.
+
image:vcf_ora_vvol_datastore_04.png["Capture d'écran montrant la configuration du datastore vVols."]

+

NOTE: Pour des performances optimales, vous pouvez ajouter plusieurs volumes à un datastore vVols ou couvrir un datastore vVols sur des nœuds de contrôleurs ONTAP.

. Cliquez `Finish` pour créer un datastore vVols pour le binaire Oracle.
+
image:vcf_ora_vvol_datastore_05.png["Capture d'écran montrant la configuration du datastore vVols."]

. Répétez les mêmes procédures pour créer un datastore vVols pour les données et le journal Oracle.
+
image:vcf_ora_vvol_datastore_06.png["Capture d'écran montrant la configuration du datastore vVols."]




NOTE: Notez que lorsqu'une base de données Oracle est clonée, un vVols supplémentaire pour les données est ajouté à la liste vVols.

====


=== Créer une règle de stockage de machine virtuelle basée sur le profil de capacité de stockage

[%collapsible]
====
Avant de provisionner le stockage du datastore vVols sur la machine virtuelle de base de données, ajoutez une règle de stockage de machine virtuelle basée sur le profil de capacité de stockage créé à l'étape précédente. Les procédures suivantes sont indiquées.

. Dans les menus du client vSphere, ouvrez `Policies and Profiles` et mettez en surbrillance `VM Storage Policies`. Cliquez `Create` pour ouvrir le `VM Storage Policies` flux de travail.
+
image:vcf_ora_vvol_vm_policy_01.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. Nommez la stratégie de stockage de la machine virtuelle.
+
image:vcf_ora_vvol_vm_policy_02.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. Dans `Datastore specific rules`, vérifier `Enable rules for "NetAPP.clustered.Data.ONTAP.VP.vvol" storage`
+
image:vcf_ora_vvol_vm_policy_03.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. Pour les règles NetApp.clustered.Data.ONTAP.VP.vvol `Placement`, sélectionnez le profil de capacité de stockage personnalisé créé à l'étape précédente.
+
image:vcf_ora_vvol_vm_policy_04.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. Pour les règles NetApp.clustered.Data.ONTAP.VP.vvol `Replication`, indiquez `Disabled` si les vVols ne sont pas répliqués.
+
image:vcf_ora_vvol_vm_policy_04_1.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. La page Storage Compatibility affiche les datastores vVols compatibles dans un environnement VCF.
+
image:vcf_ora_vvol_vm_policy_05.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. Révision et fin pour créer la stratégie de stockage de la machine virtuelle.
+
image:vcf_ora_vvol_vm_policy_06.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. Valider la règle de stockage de VM que vous venez de créer.
+
image:vcf_ora_vvol_vm_policy_07.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]



====


=== Allouer les disques à la VM de base de données à partir des datastores vVols et configurer le stockage de la base de données

[%collapsible]
====
Depuis le client vSphere, ajoutez trois disques des datastores vVols à la machine virtuelle de base de données en modifiant les paramètres de la machine virtuelle. Ensuite, connectez-vous à la machine virtuelle pour formater et monter les disques et monter les points de montage /u01, /u02 et /u03. Les étapes et les tâches suivantes sont exactes.

. Ajout d'un disque à une machine virtuelle pour le stockage binaire Oracle
+
image:vcf_ora_vvol_vm_bins.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. Ajout d'un disque à une machine virtuelle pour le stockage des données Oracle
+
image:vcf_ora_vvol_vm_data.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. Ajoutez un disque à la machine virtuelle pour le stockage des journaux Oracle.
+
image:vcf_ora_vvol_vm_logs.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. A partir de VM `Edit Settings`, `Advanced Parameters`, ajouter attribut `disk.enableuuid` avec valeur `TRUE`. La machine virtuelle doit être inactive pour ajouter le paramètre avancé. Cette option permet à SnapCenter d'identifier précisément le vVol dans votre environnement.
+
image:vcf_ora_vvol_vm_uuid.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. Redémarrez maintenant la machine virtuelle. Connectez-vous à la machine virtuelle en tant qu'administrateur via ssh pour consulter les disques récemment ajoutés.
+
....
[admin@ora_01 ~]$ sudo fdisk -l

Disk /dev/sdb: 50 GiB, 53687091200 bytes, 104857600 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk /dev/sdc: 100 GiB, 107374182400 bytes, 209715200 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk /dev/sdd: 100 GiB, 107374182400 bytes, 209715200 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

.
.
.
....
. Partitionnez les disques en tant que partition principale et partition unique en acceptant simplement les choix par défaut.
+
[source, cli]
----
sudo fdisk /dev/sdb
----
+
[source, cli]
----
sudo fdisk /dev/sdc
----
+
[source, cli]
----
sudo fdisk /dev/sdd
----
. Formatez les disques partitionnés en tant que systèmes de fichiers xfs.
+
[source, cli]
----
sudo mkfs.xfs /dev/sdb1
----
+
[source, cli]
----
sudo mkfs.xfs /dev/sdc1
----
+
[source, cli]
----
sudo mkfs.xfs /dev/sdd1
----
. Montez les lecteurs sur les points de montage /u01, /u02 et /u03.
+
[source, cli]
----
sudo mount -t xfs /dev/sdb1 /u01
----
+
[source, cli]
----
sudo mount -t xfs /dev/sdc1 /u02
----
+
[source, cli]
----
sudo mount -t xfs /dev/sdd1 /u03
----
+
....
[admin@ora_01 ~]$ df -h
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               7.7G     0  7.7G   0% /dev
tmpfs                  7.8G     0  7.8G   0% /dev/shm
tmpfs                  7.8G  782M  7.0G  10% /run
tmpfs                  7.8G     0  7.8G   0% /sys/fs/cgroup
/dev/mapper/rhel-root   44G   19G   26G  43% /
/dev/sda1             1014M  258M  757M  26% /boot
tmpfs                  1.6G   12K  1.6G   1% /run/user/42
tmpfs                  1.6G  4.0K  1.6G   1% /run/user/1000
/dev/sdb1               50G  390M   50G   1% /u01
/dev/sdc1              100G  746M  100G   1% /u02
/dev/sdd1              100G  746M  100G   1% /u03

....
. Ajoutez des points de montage à /etc/fstab pour que les disques durs soient montés lors du redémarrage de la machine virtuelle.
+
[source, cli]
----
sudo vi /etc/fstab
----
+
....
[oracle@ora_01 ~]$ cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Wed Oct 18 19:43:31 2023
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root   /                       xfs     defaults        0 0
UUID=aff942c4-b224-4b62-807d-6a5c22f7b623 /boot                   xfs     defaults        0 0
/dev/mapper/rhel-swap   none                    swap    defaults        0 0
/root/swapfile swap swap defaults 0 0
/dev/sdb1               /u01                    xfs     defaults        0 0
/dev/sdc1               /u02                    xfs     defaults        0 0
/dev/sdd1               /u03                    xfs     defaults        0 0
....


====


=== Déploiement de la base de données Oracle dans VCF

[%collapsible]
====
Il est recommandé d'utiliser le kit d'automatisation de NetApp pour déployer Oracle dans VCF avec vVols. Pour obtenir des informations détaillées sur l'exécution d'Oracle Automated Deployment sur des systèmes de fichiers xfs, reportez-vous au document TR-4992: link:https://docs.netapp.com/us-en/netapp-solutions/databases/automation_ora_c-series_nfs.html["Déploiement Oracle simplifié et automatisé sur NetApp C-Series avec NFS"^]. Bien que le rapport technique TR-4992 couvre le déploiement automatisé d'Oracle sur NetApp C-Series avec NFS, il est identique au déploiement d'Oracle dans VCF avec vVols si vous contournavez le montage de systèmes de fichiers NFS sur la machine virtuelle de base de données. Il nous suffit de sauter cela avec des étiquettes spécifiques. Les procédures suivantes sont détaillées.

. Connectez-vous à la machine virtuelle du contrôleur Ansible en tant qu'utilisateur admin via ssh, puis clonez une copie du kit d'outils d'automatisation pour Oracle sur NFS.
+
[source, cli]
----
git clone https://bitbucket.ngage.netapp.com/scm/ns-bb/na_oracle_deploy_nfs.git
----
. Placez les fichiers d'installation Oracle suivants dans le dossier /tmp/archive de la machine virtuelle de base de données. Le dossier doit permettre à tous les utilisateurs d'accéder à 777.
+
....
LINUX.X64_193000_db_home.zip
p34765931_190000_Linux-x86-64.zip
p6880880_190000_Linux-x86-64.zip
....
. Configurez le fichier cible de déploiement - hôtes, fichier de variables globales - vars/vars.yml et fichier de variables VM de base de données locale - host_vars/host_name.yml conformément aux instructions de cette section du document TR-4992: link:https://docs.netapp.com/us-en/netapp-solutions/databases/automation_ora_c-series_nfs.html#parameter-files-configuration["Configuration des fichiers de paramètres"^]. Commenter la variable nfs_lif du fichier de variable VM DB local.
. Configurez l'authentification ssh sans clé entre le contrôleur Ansible et les VM de base de données, qui nécessite de générer une paire de clés ssh et de copier la clé publique dans la base de données VM admin user root Directory .ssh folder Authorized_keys file.
+
[source, cli]
----
ssh-keygen
----
. À partir du contrôleur Ansible, clone automation toolkit home Directory /home/admin/na_oracle_Deploy_nf, execute prerequisites PlayBook.
+
[source, cli]
----
ansible-playbook -i hosts 1-ansible_requirements.yml
----
. Exécuter le manuel de configuration Linux.
+
[source, cli]
----
ansible-playbook -i hosts 2-linux_config.yml -u admin -e @vars/vars.yml
----
. Exécuter le PlayBook de déploiement Oracle
+
[source, cli]
----
ansible-playbook -i hosts 4-oracle_config.yml -u admin -e @vars/vars.yml --skip-tags "ora_mount_points,enable_dnfs_client"
----
. Tous les playbooks ci-dessus peuvent également être exécutés à partir d'un seul PlayBook.
+
[source, cli]
----
ansible-playbook -i hosts 0-all_playbook.yml -u admin -e @vars/vars.yml --skip-tags "ora_mount_points,enable_dnfs_client"
----
. Connectez-vous à EM Express à pour valider Oracle après l'exécution réussie du PlayBook.
+
image:vcf_ora_vvol_em_02.png["Capture d'écran montrant la configuration d'Oracle EM Express."] image:vcf_ora_vvol_em_01.png["Capture d'écran montrant la configuration d'Oracle EM Express."]

. Si vous le souhaitez, exécutez le manuel de destruction pour supprimer la base de données de la VM de base de données.
+
[source, cli]
----
ansible-playbook -i hosts 5-destroy.yml -u admin -e @vars/vars.yml
----


====


=== Sauvegarde, restauration et clonage Oracle dans VCF avec SnapCenter



==== Configuration SnapCenter

[%collapsible]
====
SnapCenter version 6 a de nombreuses améliorations de fonctionnalités par rapport à la version 5, y compris la prise en charge du datastore VMware vVols. SnapCenter s'appuie sur un plug-in côté hôte sur une VM de base de données pour effectuer des activités de gestion de la protection des données intégrant la cohérence applicative. Pour plus d'informations sur le plug-in NetApp SnapCenter pour Oracle, reportez-vous à cette documentation link:https://docs.netapp.com/us-en/snapcenter/protect-sco/concept_what_you_can_do_with_the_snapcenter_plug_in_for_oracle_database.html["Quelles sont les possibilités possibles grâce au plug-in pour Oracle Database"^]. Les étapes suivantes permettent de configurer SnapCenter version 6 pour la sauvegarde, la restauration et le clonage de bases de données Oracle dans VCF.

. Téléchargez la version 6 du logiciel SnapCenter sur le site de support NetApp : link:https://mysupport.netapp.com/site/downloads["Téléchargements de support NetApp"^].
. Connectez-vous à la machine virtuelle SnapCenter hébergeant Windows en tant qu'administrateur. Installer les prérequis pour SnapCenter 6.0.
+
image:vcf_ora_vvol_snapctr_prerequisites.png["Capture d'écran montrant les prérequis de SnapCenter 6.0."]

. En tant qu'administrateur, installez le JDK Java le plus récent à partir de link:https://www.java.com/en/["Obtenir Java pour les applications de bureau"^].
+

NOTE: Si le serveur Windows est déployé dans un environnement de domaine, ajoutez un utilisateur de domaine au groupe d'administrateurs locaux du serveur SnapCenter et exécutez l'installation SnapCenter avec l'utilisateur de domaine.

. Connectez-vous à l'interface utilisateur SnapCenter via le port HTTPS 8846 en tant qu'utilisateur d'installation pour configurer SnapCenter pour Oracle.
+
image:vcf_ora_vvol_snapctr_deploy_01.png["Capture d'écran montrant la configuration SnapCenter."]

. Consultez `Get Started` le menu pour vous mettre à niveau sur SnapCenter si vous êtes un nouvel utilisateur.
+
image:vcf_ora_vvol_snapctr_deploy_02.png["Capture d'écran montrant la configuration SnapCenter."]

. Mise à jour `Hypervisor Settings` dans les paramètres globaux.
+
image:aws_ora_fsx_vmc_snapctr_01.png["Capture d'écran montrant la configuration SnapCenter."]

. Ajoutez le cluster de stockage ONTAP à `Storage Systems` avec l'IP de gestion de cluster et authentifiez-vous via l'ID utilisateur de l'administrateur de cluster.
+
image:vcf_ora_vvol_snapctr_deploy_06.png["Capture d'écran montrant la configuration SnapCenter."] image:vcf_ora_vvol_snapctr_deploy_07.png["Capture d'écran montrant la configuration SnapCenter."]

. Ajoutez la VM de base de données et le plug-in vSphere pour l'accès SnapCenter à la VM de base de `Credential` données et à la VM de plug-in vSphere. Les informations d'identification doivent avoir le privilège sudo sur les machines virtuelles Linux. Vous pouvez créer des informations d'identification différentes pour différents ID d'utilisateur de gestion pour les machines virtuelles.
+
image:aws_ora_fsx_vmc_snapctr_03.png["Capture d'écran montrant la configuration SnapCenter."]

. Ajoutez la VM de base de données Oracle dans VCF à avec les informations d'identification VM de base de données `Hosts` créées à l'étape précédente.
+
image:vcf_ora_vvol_snapctr_deploy_08.png["Capture d'écran montrant la configuration SnapCenter."] image:vcf_ora_vvol_snapctr_deploy_09.png["Capture d'écran montrant la configuration SnapCenter."] image:vcf_ora_vvol_snapctr_deploy_10.png["Capture d'écran montrant la configuration SnapCenter."]

. De même, ajoutez la machine virtuelle du plug-in NetApp VMware à `Hosts` avec les informations d'identification de machine virtuelle du plug-in vSphere créées à l'étape précédente.
+
image:vcf_ora_vvol_snapctr_deploy_11.png["Capture d'écran montrant la configuration SnapCenter."] image:vcf_ora_vvol_snapctr_deploy_12.png["Capture d'écran montrant la configuration SnapCenter."]

. Enfin, une fois la base de données Oracle découverte sur la machine virtuelle de la base de données, revenir à `Settings`-`Policies` pour créer des règles de sauvegarde de la base de données Oracle. Dans l'idéal, créez une stratégie de sauvegarde de journal d'archivage distincte pour permettre des intervalles de sauvegarde plus fréquents afin de minimiser la perte de données en cas de panne.
+
image:aws_ora_fsx_vmc_snapctr_02.png["Capture d'écran montrant la configuration SnapCenter."]




NOTE: Assurez-vous que le nom du serveur SnapCenter peut être résolu sur l'adresse IP à partir de la VM DB et du plug-in vSphere. De même, le nom de la machine virtuelle de la base de données et le nom de la machine virtuelle du plug-in vSphere peuvent être résolus à l'adresse IP à partir du serveur SnapCenter.

====


==== Sauvegarde de la base de données

[%collapsible]
====
SnapCenter exploite les copies Snapshot de volume ONTAP pour accélérer considérablement la sauvegarde, la restauration ou le clonage de bases de données par rapport à la méthodologie RMAN traditionnelle. Les snapshots sont cohérents au niveau des applications, car la base de données est placée en mode de sauvegarde Oracle avant un snapshot.

. À partir du `Resources` Toutes les bases de données de la machine virtuelle sont découvertes automatiquement après l'ajout de la machine virtuelle à SnapCenter. Initialement, l'état de la base de données s'affiche comme `Not protected`.
+
image:vcf_ora_vvol_snapctr_bkup_01.png["Capture d'écran montrant la configuration SnapCenter."]

. Cliquez sur base de données pour démarrer un flux de travail afin d'activer la protection de la base de données.
+
image:vcf_ora_vvol_snapctr_bkup_02.png["Capture d'écran montrant la configuration SnapCenter."]

. Appliquez la stratégie de sauvegarde et configurez la planification si nécessaire.
+
image:vcf_ora_vvol_snapctr_bkup_03.png["Capture d'écran montrant la configuration SnapCenter."]

. Configurez la notification de tâche de sauvegarde si nécessaire.
+
image:vcf_ora_vvol_snapctr_bkup_05.png["Capture d'écran montrant la configuration SnapCenter."]

. Passez en revue le résumé et terminez pour activer la protection de la base de données.
+
image:vcf_ora_vvol_snapctr_bkup_06.png["Capture d'écran montrant la configuration SnapCenter."]

. La procédure de sauvegarde à la demande peut être déclenchée en cliquant sur `Back up Now`.
+
image:vcf_ora_vvol_snapctr_bkup_07.png["Capture d'écran montrant la configuration SnapCenter."] image:vcf_ora_vvol_snapctr_bkup_08.png["Capture d'écran montrant la configuration SnapCenter."]

. La procédure de sauvegarde peut être surveillée sur le `Monitor` en cliquant sur le travail en cours.
+
image:vcf_ora_vvol_snapctr_bkup_09.png["Capture d'écran montrant la configuration SnapCenter."]

. Cliquez sur base de données pour vérifier les jeux de sauvegarde terminés pour chaque base de données.
+
image:vcf_ora_vvol_snapctr_bkup_10.png["Capture d'écran montrant la configuration SnapCenter."]



====


==== Restauration/récupération de la base de données

[%collapsible]
====
SnapCenter propose un certain nombre d'options de restauration et de récupération pour les bases de données Oracle à partir de la sauvegarde de snapshots. Dans cet exemple, nous démontrons que la restauration s'effectue à partir d'une ancienne sauvegarde de snapshot, puis que la base de données est repassée au dernier journal disponible.

. Tout d'abord, exécutez une sauvegarde de snapshot. Ensuite, créez une table de test et insérez une ligne dans la table pour valider la base de données récupérée à partir de l'image snapshot avant que la création de la table de test ne retrouve la table de test.
+
....
[oracle@ora_01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Jul 17 10:20:10 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> sho pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP1_PDB1                     READ WRITE NO
         4 NTAP1_PDB2                     READ WRITE NO
         5 NTAP1_PDB3                     READ WRITE NO
SQL> alter session set container=ntap1_pdb1;

SQL> select * from test;

no rows selected


SQL> insert into test values (1, sysdate, 'test oracle backup/restore/clone on VMware Cloud Foundation vVols');

1 row created.

SQL> commit;

Commit complete.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
18-JUL-24 11.15.03.000000 AM
test oracle backup/restore/clone on VMware Cloud Foundation vVols


SQL>


....
. Dans l'onglet SnapCenter `Resources` , ouvrez la page topologie de sauvegarde NTAP1 de la base de données. Mettez en avant le jeu de sauvegarde des données Snapshot avant la création du tableau de test. Cliquez sur `Restore` pour lancer le workflow de restauration/restauration.
+
image:vcf_ora_vvol_snapctr_restore_01.png["Capture d'écran montrant la configuration SnapCenter."]

. Choisissez la portée de la restauration.
+
image:vcf_ora_vvol_snapctr_restore_02.png["Capture d'écran montrant la configuration SnapCenter."]

. Choisissez étendue de récupération à `All Logs`.
+
image:vcf_ora_vvol_snapctr_restore_03.png["Capture d'écran montrant la configuration SnapCenter."]

. Spécifiez les pré-scripts facultatifs à exécuter.
+
image:vcf_ora_vvol_snapctr_restore_04.png["Capture d'écran montrant la configuration SnapCenter."]

. Spécifiez tout script après exécution facultatif.
+
image:vcf_ora_vvol_snapctr_restore_05.png["Capture d'écran montrant la configuration SnapCenter."]

. Envoyez un rapport de travail si vous le souhaitez.
+
image:vcf_ora_vvol_snapctr_restore_06.png["Capture d'écran montrant la configuration SnapCenter."]

. Passez en revue le résumé et cliquez sur `Finish` pour lancer la restauration et la récupération.
+
image:vcf_ora_vvol_snapctr_restore_07.png["Capture d'écran montrant la configuration SnapCenter."]

. De `Monitor` ouvrez le travail pour vérifier les détails.
+
image:vcf_ora_vvol_snapctr_restore_08.png["Capture d'écran montrant la configuration SnapCenter."]

. À partir de la VM ora_01 de la BDD, vérifiez que la restauration/restauration de la base de données a été effectuée avec succès jusqu'à son état le plus récent et que la table de test a été restaurée.
+
....

[oracle@ora_01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Thu Jul 18 11:42:58 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode from v$database;

NAME      OPEN_MODE
--------- --------------------
NTAP1     READ WRITE

SQL> alter session set container=ntap1_pdb1;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
18-JUL-24 11.15.03.000000 AM
test oracle backup/restore/clone on VMware Cloud Foundation vVols


SQL>


....


====


==== Clone de base de données

[%collapsible]
====
Dans cet exemple, les jeux de sauvegarde les plus récents sont utilisés pour cloner une base de données sur la VM ora_02 de BD dans une autre installation logicielle et ORACLE_HOME dans VCF.

. Ouvrez à nouveau la liste de sauvegarde NTAP1 de la base de données. Sélectionnez le jeu de sauvegarde de données le plus récent, cliquez sur le `Clone` bouton pour lancer le flux de travail de clonage de base de données.
+
image:vcf_ora_vvol_snapctr_clone_01.png["Capture d'écran montrant la configuration SnapCenter."]

. Nommer le SID de la base de données clone.
+
image:vcf_ora_vvol_snapctr_clone_02.png["Capture d'écran montrant la configuration SnapCenter."]

. Sélectionnez ora_02 dans VCF comme hôte de clonage de base de données cible. Un logiciel de base de données Oracle identique doit avoir été installé et configuré sur l'hôte.
+
image:vcf_ora_vvol_snapctr_clone_03.png["Capture d'écran montrant la configuration SnapCenter."]

. Sélectionnez le RÉPERTOIRE ORACLE_HOME, l'utilisateur et le groupe appropriés sur l'hôte cible. Conserver les informations d'identification par défaut.
+
image:vcf_ora_vvol_snapctr_clone_04.png["Capture d'écran montrant la configuration SnapCenter."]

. Vous pouvez modifier les paramètres de la base de données de clonage pour répondre aux exigences de configuration ou de ressources de la base de données de clonage.
+
image:vcf_ora_vvol_snapctr_clone_05.png["Capture d'écran montrant la configuration SnapCenter."]

. Choisir la portée de la restauration. `Until Cancel` récupère le clone jusqu'au dernier fichier journal disponible dans le jeu de sauvegarde.
+
image:vcf_ora_vvol_snapctr_clone_06.png["Capture d'écran montrant la configuration SnapCenter."]

. Passez en revue le récapitulatif et lancez la tâche de clonage.
+
image:vcf_ora_vvol_snapctr_clone_08.png["Capture d'écran montrant la configuration SnapCenter."]

. Surveiller l'exécution de la tâche de clonage à partir de `Monitor` onglet.
+
image:vcf_ora_vvol_snapctr_clone_09.png["Capture d'écran montrant la configuration SnapCenter."]

. La base de données clonée est immédiatement enregistrée dans SnapCenter.
+
image:vcf_ora_vvol_snapctr_clone_10.png["Capture d'écran montrant la configuration SnapCenter."]

. À partir de la VM ora_02 de la BD, validez la base de données clonée et interrogez la table de test.
+
....
[oracle@ora_02 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Thu Jul 18 12:06:48 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP1CLN  READ WRITE           ARCHIVELOG

SQL> select instance_name, host_name from v$instance;

INSTANCE_NAME
----------------
HOST_NAME
----------------------------------------------------------------
NTAP1CLN
ora_02


SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP1_PDB1                     READ WRITE NO
         4 NTAP1_PDB2                     READ WRITE NO
         5 NTAP1_PDB3                     READ WRITE NO
SQL> alter session set container=ntap1_pdb1
  2  ;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
18-JUL-24 11.15.03.000000 AM
test oracle backup/restore/clone on VMware Cloud Foundation vVols


SQL>

....


La démonstration de la sauvegarde, de la restauration et du clonage SnapCenter de la base de données Oracle dans VCF est terminée.

====


== Où trouver des informations complémentaires

Pour en savoir plus sur les informations fournies dans ce document, consultez ces documents et/ou sites web :

* Socle cloud VMware
+
link:https://www.vmware.com/products/cloud-infrastructure/vmware-cloud-foundation["https://www.vmware.com/products/cloud-infrastructure/vmware-cloud-foundation"^]

* Solutions NetApp pour bases de données d'entreprise
+
link:https://docs.netapp.com/us-en/netapp-solutions/databases/index.html["https://docs.netapp.com/us-en/netapp-solutions/databases/index.html"^]

* Logiciel SnapCenter 6.0
+
link:https://docs.netapp.com/us-en/snapcenter/concept/concept_snapcenter_overview.html["https://docs.netapp.com/us-en/snapcenter/concept/concept_snapcenter_overview.html"^]


