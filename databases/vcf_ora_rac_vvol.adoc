---
sidebar: sidebar 
permalink: databases/vcf_ora_rac_vvol.html 
keywords: Database, Oracle, AWS, FSx ONTAP, VMC, VMware 
summary: 'La solution offre une vue d"ensemble et des informations détaillées sur le déploiement et la protection d"Oracle dans VMware Cloud Foundation (VCF) avec les volumes virtuels vSphere (vVols) en tant que stockage de base de données primaire et la base de données Oracle en configuration RAC (Real application clusters).' 
---
= Tr-4997 : déploiement et protection d'Oracle RAC dans VCF avec vVols
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


Allen Cao, Niyaz Mohamed, NetApp

[role="lead"]
La solution offre une vue d'ensemble et des informations détaillées sur le déploiement et la protection d'Oracle dans VMware Cloud Foundation (VCF) avec les volumes virtuels vSphere (vVols) en tant que stockage de base de données primaire et la base de données Oracle en configuration RAC (Real application clusters).



== Objectif

VMware vSphere Virtual volumes (vVols) est un framework de gestion et d'intégration SAN/NAS qui expose les disques virtuels en tant qu'objets de stockage natifs et permet des opérations basées sur les baies au niveau du disque virtuel. En d'autres termes, les vVols permettent aux périphériques SAN/NAS de prendre en charge les machines virtuelles et libèrent la possibilité d'exploiter des services de données basés sur les baies grâce à une approche axée sur les machines virtuelles, au niveau de la granularité d'un seul disque virtuel. VVols permet aux clients de tirer parti des capacités uniques de leurs investissements actuels en matière de stockage et de passer sans interruption à un modèle opérationnel plus simple et plus efficace, optimisé pour les environnements virtuels fonctionnant sur tous les types de stockage.

Dans link:vcf_ora_si_vvol.html["TR-4996"^], nous avons démontré le déploiement et la protection de bases de données Oracle à instance unique dans VCF avec vVols. Ce document présente le déploiement et la protection d'une base de données RAC Oracle dans un environnement VMware Cloud Foundation avec vVols comme stockage de base de données primaire dans un cluster de stockage NetApp ONTAP. La base de données Oracle RAC est configurée comme si elle était déployée dans des systèmes de fichiers locaux sur un système de stockage local. Ce rapport technique porte sur les étapes de création de vVols dans VCF pour le déploiement d'Oracle RAC. Nous démontrons également le déploiement de bases de données Oracle RAC dans VCF sur vVols avec le kit d'automatisation NetApp et la protection de bases de données RAC avec l'outil d'interface utilisateur NetApp SnapCenter.

Cette solution répond aux cas d'utilisation suivants :

* Déploiement de la base de données Oracle RAC dans VCF avec datastore vVols sur NetApp ONTAP AFF en tant que stockage de base de données primaire
* Sauvegarde et restauration de bases de données Oracle dans VCF avec datastore vVols à l'aide de l'outil d'interface utilisateur NetApp SnapCenter




== Public

Cette solution est destinée aux personnes suivantes :

* Administrateur de base de données qui souhaite déployer Oracle RAC dans VCF avec un datastore vVols sur NetApp ONTAP AFF en tant que stockage de base de données primaire
* Architecte de solutions de bases de données qui souhaite tester les workloads Oracle RAC dans VCF avec un datastore vVols sur stockage NetApp ONTAP AFF
* Administrateur du stockage qui souhaite déployer et gérer une base de données RAC Oracle déployée sur VCF avec un datastore vVols sur le stockage NetApp ONTAP AFF
* Propriétaire d'application qui souhaite créer une base de données Oracle RAC dans VCF avec un datastore vVol




== Environnement de test et de validation de la solution

Les tests et la validation de cette solution ont été réalisés dans un environnement de laboratoire dans VCF avec un datastore vVols sur du stockage NetApp ONTAP AFF qui ne correspond peut-être pas à l'environnement de déploiement final. Pour plus d'informations, reportez-vous à la section <<Facteurs clés à prendre en compte lors du déploiement>>.



=== Architecture

image:vcf_orarac_vvol_architecture.png["Cette image fournit une vue détaillée de la configuration du déploiement Oracle dans le cloud public AWS avec iSCSI et ASM."]



=== Composants matériels et logiciels

[cols="33%, 33%, 33%"]
|===


3+| *Matériel* 


| NetApp ONTAP AFF A300 | Version 9.14.1P4 | Tiroir DS224 avec 24 disques NVMe, capacité totale de 35.2 Tio 


| Cluster VMware vSphere | Version 8.02 | 12 processeurs x Intel(R) Xeon(R) Gold 5218 à 2,30 GHz, 8 nœuds (4 domaines de gestion et 4 domaines de charge de travail) 


3+| *Logiciel* 


| Red Hat Linux | Noyau RHEL-8.6, 4.18.0-372.9.1.el8.x86_64 | Hébergement des serveurs de base de données Oracle, déploiement de l'abonnement RedHat pour le test 


| Serveur Windows | 2022 Standard, 10.0.20348 année de construction 20348 | Hébergement du serveur SnapCenter 


| CentOS Linux | CentOS Linux version 8.5.2111 | Hébergement du contrôleur Ansible 


| Infrastructure Oracle Grid | Version 19.18 | Patch RU appliqué p34762026_190000_Linux-x86-64.zip 


| Base de données Oracle | Version 19.18 | Patch RU appliqué p34765931_190000_Linux-x86-64.zip 


| OPICH Oracle | Version 12.2.0.1.36 | Dernier correctif p6880880_190000_Linux-x86-64.zip 


| Serveur SnapCenter | Version 6.0 | Déploiement de groupes de travail 


| Plug-in SnapCenter pour VMware vSphere | Version 6.0 | Déployée en tant que machine virtuelle ova dans le cluster vSphere 


| Outil ONTAP pour VMware vSphere | Version 9.13 | Déployée en tant que machine virtuelle ova dans le cluster vSphere 


| Ouvrez JDK | Version Java-11-openjdk-11.0.23.0.9-3.el8.x86_64 | Plug-in SnapCenter requis sur les VM de base de données 
|===


=== Configuration de la base de données Oracle RAC dans VCF

[cols="33%, 33%, 33%"]
|===


3+|  


| *Nœud RAC* | *Base de données* | *Stockage DB* 


| ora01 | NTAP(NTAP_pdb1,NTAP_pdb2,NTAP_pdb3) | DATASTORES VVOLS (VCF_ORA_BINS, VCF_ORA_CRS, VCF_ORA_DAT1, VCF_ORA_DAT2, VCF_ORA_LOGS) SUR NetApp ONTAP AFF A300 


| ora02 | NTAP(NTAP_pdb1,NTAP_pdb2,NTAP_pdb3) | DATASTORES VVOLS (VCF_ORA_BINS, VCF_ORA_CRS, VCF_ORA_DAT1, VCF_ORA_DAT2, VCF_ORA_LOGS) SUR NetApp ONTAP AFF A300 
|===


=== Facteurs clés à prendre en compte lors du déploiement

* *Protocole pour vVols à la connectivité du cluster ONTAP.* NFS ou iSCSI sont un bon choix. Les niveaux de performances sont équivalents. Dans cette démonstration de solution, nous avons utilisé iSCSI comme protocole de stockage pour la connectivité vVols vers le cluster de stockage ONTAP souligné. Si l'infrastructure VCF est prise en charge, les protocoles FC/FCoE, NVMe/FC sont également pris en charge pour les datastores vVols sur NetApp ONTAP.
* *Disposition du stockage Oracle sur les datastores vVols.* Lors de nos tests et de nos validations, nous avons déployé cinq datastores vVols pour les fichiers binaires Oracle, le registre/vote de cluster Oracle, les données Oracle et les fichiers journaux Oracle. Il est recommandé de séparer les différents types de fichiers Oracle dans leurs propres datastores afin de faciliter la gestion et l'exécution de la sauvegarde, de la restauration ou du clone de la base de données. Créez des vVols dédiés aux grandes bases de données et partagez des vVols pour les bases de données plus petites ou avec un profil de QoS similaire. 
* *Redondance du stockage Oracle.* À utiliser `Normal Redundancy` pour les fichiers de registre/vote de cluster Oracle RAC critiques, de sorte que trois fichiers de vote sur trois groupes de défaillance de disque ASM offrent une protection optimale du cluster et que le registre de cluster est mis en miroir parmi les groupes de défaillance de disque ASM. Utilisation `External Redundancy` pour les fichiers binaires, de données et de journaux Oracle afin d'optimiser l'utilisation du stockage Le RAID-DP ONTAP souligné assure la protection des données lorsque `External Redundancy` est utilisé.
* *Informations d'identification pour l'authentification de stockage ONTAP.* Utilisez uniquement les informations d'identification ONTAP au niveau du cluster pour l'authentification du cluster de stockage ONTAP, y compris la connectivité SnapCenter au cluster de stockage ONTAP ou à l'outil ONTAP au cluster de stockage ONTAP.
* *Provisionnement du stockage du datastore vVols sur la machine virtuelle de base de données.* Ajoutez un seul disque à la fois à la machine virtuelle de la base de données à partir du datastore vVols. L'ajout simultané de plusieurs disques à partir des datastores vVols n'est pas pris en charge pour le moment.  
* *Protection de la base de données.* NetApp propose une suite logicielle SnapCenter pour la sauvegarde et la restauration des bases de données à l'aide d'une interface utilisateur conviviale. NetApp recommande de mettre en œuvre cet outil de gestion afin de bénéficier d'une sauvegarde Snapshot rapide et d'une restauration et d'une récupération rapides des bases de données.




== Déploiement de la solution

Les sections suivantes présentent des procédures détaillées pour le déploiement de bases de données Oracle 19c dans VCF avec datastores vVols sur stockage NetApp ONTAP dans une configuration Oracle RAC.



=== Conditions préalables au déploiement

[%collapsible]
====
Le déploiement nécessite les conditions préalables suivantes.

. Un VMware VCF a été configuré. Pour plus d'informations ou d'instructions sur la création d'un VCF, reportez-vous à la documentation VMware link:https://docs.vmware.com/en/VMware-Cloud-Foundation/index.html["Documentation de VMware Cloud Foundation"^].
. Provisionnez trois VM Linux, deux VM pour le cluster de bases de données Oracle RAC et une VM pour le contrôleur Ansible dans le domaine de charges de travail VCF. Provisionner une machine virtuelle de serveur Windows pour exécuter NetApp SnapCenter Server. Pour plus d'informations sur la configuration du contrôleur Ansible pour le déploiement automatisé de bases de données Oracle, reportez-vous aux ressources suivantes link:../automation/getting-started.html["Commencer à utiliser l'automatisation des solutions NetApp"^].
. Les VM de base de données Oracle RAC doivent avoir provisionné au moins deux interfaces réseau : une pour l'interconnexion privée Oracle RAC et une pour les applications ou le trafic de données public.
. Le plug-in SnapCenter version 6.0 pour VMware vSphere a été déployé dans VCF. Reportez-vous aux ressources suivantes pour le déploiement du plug-in : link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/["Documentation du plug-in SnapCenter pour VMware vSphere"^].
. L'outil ONTAP pour VMware vSphere a été déployé dans VCF. Consultez les ressources suivantes pour l'outil ONTAP de déploiement de VMware vSphere : link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["Documentation sur les outils ONTAP pour VMware vSphere"^]



NOTE: Assurez-vous d'avoir alloué au moins 50G dans le volume racine d'Oracle VM afin de disposer d'un espace suffisant pour préparer les fichiers d'installation d'Oracle.

====


=== Créer un profil de capacité de stockage

[%collapsible]
====
Tout d'abord, créez un profil de capacité de stockage personnalisé pour le stockage ONTAP souligné qui héberge le datastore vVols.

. Dans les raccourcis client vSphere, ouvrez l'outil NetApp ONTAP. Vérifier que le cluster de stockage ONTAP a été ajouté à `Storage Systems` dans le cadre du déploiement de l'outil ONTAP.
+
image:vcf_ora_vvol_scp_01.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."] image:vcf_ora_vvol_scp_00.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]

. Cliquez sur `Storage capability profile` pour ajouter un profil personnalisé pour Oracle. Nommez le profil et ajoutez une brève description.
+
image:vcf_ora_vvol_scp_02.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]

. Choisissez la catégorie de contrôleur de stockage : performances, capacité ou hybride.
+
image:vcf_ora_vvol_scp_03.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]

. Sélectionnez le protocole.
+
image:vcf_ora_vvol_scp_04.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]

. Si nécessaire, définissez une règle de QoS.
+
image:vcf_ora_vvol_scp_05.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]

. Attributs de stockage supplémentaires pour le profil. Assurez-vous que le cryptage est activé sur le contrôleur NetApp si vous souhaitez disposer de la fonction de cryptage ou qu'il peut causer des problèmes lors de l'application du profil.
+
image:vcf_ora_vvol_scp_06.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]

. Vérifiez le récapitulatif et terminez la création du profil de capacité de stockage.
+
image:vcf_ora_vvol_scp_07.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisée."]



====


=== Créer et configurer le datastore vVols

[%collapsible]
====
Une fois les conditions préalables remplies, connectez-vous au VCF en tant qu'utilisateur administrateur via le client vSphere, en accédant au domaine de charge de travail. N'utilisez pas l'option de stockage VMware intégrée pour créer des vVols. Utilisez plutôt l'outil NetApp ONTAP pour créer des vVols. La présente procédure de création et de configuration de vVols est la suivante.

. Le workflow de création des vVols peut être déclenché à partir de l'interface de l'outil ONTAP ou du cluster du domaine de charge de travail VCF.
+
image:vcf_ora_vvol_datastore_01.png["Capture d'écran montrant la configuration du datastore vVols."]

+
image:vcf_ora_vvol_datastore_01_2.png["Capture d'écran montrant la configuration du datastore vVols."]

. Saisie d'informations générales pour le datastore, y compris la destination de provisionnement, le type, le nom et le protocole.
+
image:vcf_orarac_vvol_datastore_01.png["Capture d'écran montrant la configuration du datastore vVols."]

. Sélectionnez le profil de capacité de stockage personnalisé créé à partir de l'étape précédente, les `Storage system`, et `Storage VM`, où les vVols doivent être créés.
+
image:vcf_orarac_vvol_datastore_02.png["Capture d'écran montrant la configuration du datastore vVols."]

. Choisissez `Create new volumes`, indiquez le nom et la taille du volume et cliquez sur, puis sur `ADD` `NEXT` pour accéder à la page de résumé.
+
image:vcf_orarac_vvol_datastore_03.png["Capture d'écran montrant la configuration du datastore vVols."] image:vcf_orarac_vvol_datastore_04.png["Capture d'écran montrant la configuration du datastore vVols."]

. Cliquez `Finish` pour créer un datastore vVols pour le binaire Oracle.
+
image:vcf_orarac_vvol_datastore_05.png["Capture d'écran montrant la configuration du datastore vVols."]

. Créez un datastore pour le registre de cluster Oracle ou CRS.
+
image:vcf_orarac_vvol_datastore_06.png["Capture d'écran montrant la configuration du datastore vVols."]

+

NOTE: Vous pouvez ajouter plusieurs volumes à un datastore vVols ou étendre des volumes de datastores vVols sur des nœuds de contrôleurs ONTAP à des fins de performances ou de redondance.

. Créez un datastore pour les données Oracle. Dans l'idéal, créez des datastores distincts sur chaque nœud de contrôleur ONTAP et utilisez Oracle ASM pour répartir les données entre les nœuds de contrôleur afin d'optimiser l'utilisation de la capacité du cluster de stockage ONTAP.
+
image:vcf_orarac_vvol_datastore_06_1.png["Capture d'écran montrant la configuration du datastore vVols."] image:vcf_orarac_vvol_datastore_06_2.png["Capture d'écran montrant la configuration du datastore vVols."]

. Créez un datastore pour le journal Oracle. Étant donné la nature séquentielle des écritures de journaux Oracle, il est judicieux de les placer sur un seul nœud de contrôleur ONTAP.
+
image:vcf_orarac_vvol_datastore_06_3.png["Capture d'écran montrant la configuration du datastore vVols."]

. Valider les datastores Oracle après le déploiement.
+
image:vcf_orarac_vvol_datastore_07.png["Capture d'écran montrant la configuration du datastore vVols."]



====


=== Créer une règle de stockage de machine virtuelle basée sur le profil de capacité de stockage

[%collapsible]
====
Avant de provisionner le stockage du datastore vVols sur la machine virtuelle de base de données, ajoutez une règle de stockage de machine virtuelle basée sur le profil de capacité de stockage créé à l'étape précédente. Les procédures suivantes sont indiquées.

. Dans les menus du client vSphere, ouvrez `Policies and Profiles` et mettez en surbrillance `VM Storage Policies`. Cliquez `Create` pour ouvrir le `VM Storage Policies` flux de travail.
+
image:vcf_ora_vvol_vm_policy_01.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. Nommez la stratégie de stockage de la machine virtuelle.
+
image:vcf_ora_vvol_vm_policy_02.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. Dans `Datastore specific rules`, vérifier `Enable rules for "NetAPP.clustered.Data.ONTAP.VP.vvol" storage`
+
image:vcf_ora_vvol_vm_policy_03.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. Pour les règles NetApp.clustered.Data.ONTAP.VP.vvol `Placement`, sélectionnez le profil de capacité de stockage personnalisé créé à l'étape précédente.
+
image:vcf_ora_vvol_vm_policy_04.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. Pour les règles NetApp.clustered.Data.ONTAP.VP.vvol `Replication`, indiquez `Disabled` si les vVols ne sont pas répliqués.
+
image:vcf_ora_vvol_vm_policy_04_1.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. La page Storage Compatibility affiche les datastores vVols compatibles dans un environnement VCF.
+
image:vcf_orarac_vvol_datastore_08.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. Révision et fin pour créer la stratégie de stockage de la machine virtuelle.
+
image:vcf_ora_vvol_vm_policy_06.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]

. Valider la règle de stockage de VM que vous venez de créer.
+
image:vcf_ora_vvol_vm_policy_07.png["Capture d'écran montrant la configuration d'une stratégie de stockage de machine virtuelle."]



====


=== Allouez des disques aux machines virtuelles RAC à partir des datastores vVols et configurez le stockage de la base de données

[%collapsible]
====
Depuis le client vSphere, ajoutez les disques souhaités des datastores vVols à la machine virtuelle de base de données en modifiant les paramètres de la machine virtuelle. Ensuite, connectez-vous à la machine virtuelle pour formater et monter le disque binaire afin de monter les points /u01. Les étapes et les tâches suivantes sont exactes.

. Avant d'allouer des disques du datastore à la machine virtuelle de la base de données, connectez-vous aux hôtes VMware ESXi pour valider et vérifier que le multi-writer est activé (valeur GBLALLOWMW définie sur 1) au niveau ESXi.
+
....
[root@vcf-wkld-esx01:~] which esxcli
/bin/esxcli
[root@vcf-wkld-esx01:~] esxcli system settings advanced list -o /VMFS3/GBLAllowMW
   Path: /VMFS3/GBLAllowMW
   Type: integer
   Int Value: 1
   Default Int Value: 1
   Min Value: 0
   Max Value: 1
   String Value:
   Default String Value:
   Valid Characters:
   Description: Allow multi-writer GBLs.
   Host Specific: false
   Impact: none
[root@vcf-wkld-esx01:~]

....
. Ajoutez un nouveau contrôleur SCSI dédié pour une utilisation avec les disques RAC Oracle. Désactivez le partage de bus SCSI.
+
image:vcf_orarac_vvol_vm_01.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. À partir du nœud RAC 1 - ora01, ajoutez un disque à la machine virtuelle pour le stockage binaire Oracle sans partage.
+
image:vcf_orarac_vvol_vm_02.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. À partir du nœud RAC 1, ajoutez trois disques à la machine virtuelle pour le stockage CRS Oracle RAC et activez le partage multi-writer.
+
image:vcf_orarac_vvol_vm_03.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf_orarac_vvol_vm_04.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf_orarac_vvol_vm_05.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. À partir du nœud RAC 1, ajoutez deux disques à partir de chaque datastore pour les données à la machine virtuelle pour le stockage de données Oracle partagé.
+
image:vcf_orarac_vvol_vm_06.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf_orarac_vvol_vm_08.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf_orarac_vvol_vm_09.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf_orarac_vvol_vm_10.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. À partir du nœud RAC 1, ajoutez deux disques à la machine virtuelle à partir du datastore de journaux pour le stockage partagé des fichiers journaux Oracle.
+
image:vcf_orarac_vvol_vm_11.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf_orarac_vvol_vm_12.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. À partir du nœud RAC 2, ajoutez un disque à la machine virtuelle pour le stockage binaire Oracle sans partage.
+
image:vcf_orarac_vvol_vm_13.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. À partir du nœud RAC 2, ajoutez d'autres disques partagés en sélectionnant `Existing Hard Disks` option et activez le partage multi-writer pour chaque disque partagé.
+
image:vcf_orarac_vvol_vm_14.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf_orarac_vvol_vm_15.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. A partir de VM `Edit Settings`, `Advanced Parameters`, ajouter attribut `disk.enableuuid` avec valeur `TRUE`. La machine virtuelle doit être inactive pour ajouter le paramètre avancé. Cette option permet à SnapCenter d'identifier précisément le vVol dans votre environnement. Cette opération doit être effectuée sur tous les nœuds RAC.
+
image:vcf_ora_vvol_vm_uuid.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. Redémarrez maintenant la machine virtuelle. Connectez-vous à la machine virtuelle en tant qu'administrateur via ssh pour consulter les disques récemment ajoutés.
+
....
[admin@ora01 ~]$ sudo lsblk
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda             8:0    0   50G  0 disk
├─sda1          8:1    0  600M  0 part /boot/efi
├─sda2          8:2    0    1G  0 part /boot
└─sda3          8:3    0 48.4G  0 part
  ├─rhel-root 253:0    0 43.4G  0 lvm  /
  └─rhel-swap 253:1    0    5G  0 lvm  [SWAP]
sdb             8:16   0   50G  0 disk
sdc             8:32   0   10G  0 disk
sdd             8:48   0   10G  0 disk
sde             8:64   0   10G  0 disk
sdf             8:80   0   40G  0 disk
sdg             8:96   0   40G  0 disk
sdh             8:112  0   40G  0 disk
sdi             8:128  0   40G  0 disk
sdj             8:144  0   80G  0 disk
sdk             8:160  0   80G  0 disk
sr0            11:0    1 1024M  0 rom
[admin@ora01 ~]$

[admin@ora02 ~]$ sudo lsblk
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda             8:0    0   50G  0 disk
├─sda1          8:1    0  600M  0 part /boot/efi
├─sda2          8:2    0    1G  0 part /boot
└─sda3          8:3    0 48.4G  0 part
  ├─rhel-root 253:0    0 43.4G  0 lvm  /
  └─rhel-swap 253:1    0    5G  0 lvm  [SWAP]
sdb             8:16   0   50G  0 disk
sdc             8:32   0   10G  0 disk
sdd             8:48   0   10G  0 disk
sde             8:64   0   10G  0 disk
sdf             8:80   0   40G  0 disk
sdg             8:96   0   40G  0 disk
sdh             8:112  0   40G  0 disk
sdi             8:128  0   40G  0 disk
sdj             8:144  0   80G  0 disk
sdk             8:160  0   80G  0 disk
sr0            11:0    1 1024M  0 rom
[admin@ora02 ~]$


....
. À partir de chaque nœud RAC, partitionnez le disque binaire Oracle (/dev/sdb) en tant que partition principale et unique en acceptant simplement les choix par défaut.
+
[source, cli]
----
sudo fdisk /dev/sdb
----
. Formatez les disques partitionnés en tant que systèmes de fichiers xfs.
+
[source, cli]
----
sudo mkfs.xfs /dev/sdb1
----
. Montez le disque sur le point de montage /u01.
+
....
[admin@ora01 ~]$ df -h
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               7.7G   36K  7.7G   1% /dev
tmpfs                  7.8G  1.4G  6.4G  18% /dev/shm
tmpfs                  7.8G   34M  7.7G   1% /run
tmpfs                  7.8G     0  7.8G   0% /sys/fs/cgroup
/dev/mapper/rhel-root   44G   29G   16G  66% /
/dev/sda2             1014M  249M  766M  25% /boot
/dev/sda1              599M  5.9M  593M   1% /boot/efi
/dev/sdb1               50G   24G   27G  47% /u01
tmpfs                  1.6G   12K  1.6G   1% /run/user/42
tmpfs                  1.6G     0  1.6G   0% /run/user/54331
tmpfs                  1.6G  4.0K  1.6G   1% /run/user/1000


....
. Ajoutez des points de montage à /etc/fstab pour que les disques durs soient montés lors du redémarrage de la machine virtuelle.
+
[source, cli]
----
sudo vi /etc/fstab
----
+
....
[oracle@ora_01 ~]$ cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Wed Oct 18 19:43:31 2023
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root   /                       xfs     defaults        0 0
UUID=aff942c4-b224-4b62-807d-6a5c22f7b623 /boot                   xfs     defaults        0 0
/dev/mapper/rhel-swap   none                    swap    defaults        0 0
/root/swapfile swap swap defaults 0 0
/dev/sdb1               /u01                    xfs     defaults        0 0
....


====


=== Déploiement d'Oracle RAC dans VCF

[%collapsible]
====
Il est recommandé d'utiliser le kit d'automatisation NetApp pour déployer Oracle RAC dans VCF avec vVols. Lisez attentivement le fichier d'instructions fourni (readme) et configurez les fichiers de paramètres de déploiement tels que le fichier cible de déploiement - hôtes, le fichier de variables globales - vars/vars.yml et le fichier de variables VM BD local - host_vars/host_name.yml en suivant les instructions de la boîte à outils. Voici les procédures étape par étape.

. Connectez-vous à la machine virtuelle du contrôleur Ansible en tant qu'utilisateur admin via ssh et clonez une copie du kit d'automatisation pour le déploiement d'Oracle RAC dans VCF avec vVols.
+
[source, cli]
----
git clone https://bitbucket.ngage.netapp.com/scm/ns-bb/na_oracle_deploy_rac.git
----
. Placez les fichiers d'installation Oracle suivants dans le dossier /tmp/archive de la machine virtuelle de base de données du nœud RAC 1. Le dossier doit permettre à tous les utilisateurs d'accéder à 777.
+
....
LINUX.X64_193000_grid_home.zip
p34762026_190000_Linux-x86-64.zip
LINUX.X64_193000_db_home.zip
p34765931_190000_Linux-x86-64.zip
p6880880_190000_Linux-x86-64.zip
....
. Configurez l'authentification ssh sans clé entre le contrôleur Ansible et les VM de base de données, qui nécessite de générer une paire de clés ssh et de copier la clé publique dans la base de données VM admin user root Directory .ssh folder Authorized_keys file.
+
[source, cli]
----
ssh-keygen
----
. Configurez les fichiers de paramètres d'hôte cible définis par l'utilisateur. Voici un exemple de configuration type pour le fichier hosts cible : hosts.
+
....
#Oracle hosts
[oracle]
ora01 ansible_host=10.61.180.21 ansible_ssh_private_key_file=ora01.pem
ora02 ansible_host=10.61.180.22 ansible_ssh_private_key_file=ora02.pem

....
. Configurez les fichiers de paramètres spécifiques à l'hôte local définis par l'utilisateur. Voici un exemple de configuration type pour le fichier local host_name.yml - ora01.yml.
+
....

# Binary lun
ora_bin: /dev/sdb

# Host DB configuration
ins_sid: "{{ oracle_sid }}1"
asm_sid: +ASM1

....
. Configurez le fichier de paramètres globaux défini par l'utilisateur. Voici un exemple de configuration type pour le fichier de paramètres globaux - vars.yml
+
....

#######################################################################
### ONTAP env specific config variables                             ###
#######################################################################

# ONTAP storage platform: on-prem, vmware-vvols
ontap_platform: vmware-vvols

# Prerequisite to create five vVolss in VMware vCenter
# VCF_ORA_BINS - Oracle binary
# VCF_ORA_CRS  - Oracle cluster registry and vote
# VCF_ORA_DAT1 - Oracle data on node1
# VCF_ORA_DAT2 - Oracle data on node2
# VCF_ORA_LOGS - Oracle logs on node1 or node2

# Oracle disks are added to VM from vVols: 1 binary disk, 3 CRS disks, 4 data disks, and 2 log disks.


######################################################################
### Linux env specific config variables                            ###
######################################################################

redhat_sub_username: XXXXXXXX
redhat_sub_password: "XXXXXXXX"

# Networking configuration
cluster_pub_ip:
  - {ip: 10.61.180.21, hostname: ora01}
  - {ip: 10.61.180.22, hostname: ora02}

cluster_pri_ip:
  - {ip: 172.21.166.22, hostname: ora01-pri}
  - {ip: 172.21.166.24, hostname: ora02-pri}

cluster_vip_ip:
  - {ip: 10.61.180.93, hostname: ora01-vip}
  - {ip: 10.61.180.94, hostname: ora02-vip}

cluster_scan_name: ntap-scan
cluster_scan_ip:
  - {ip: 10.61.180.90, hostname: ntap-scan}
  - {ip: 10.61.180.91, hostname: ntap-scan}
  - {ip: 10.61.180.92, hostname: ntap-scan}


#####################################################################
### DB env specific install and config variables                  ###
#####################################################################

# Shared Oracle RAC storage
ora_crs:
  - { device: /dev/sdc, name: ora_crs_01 }
  - { device: /dev/sdd, name: ora_crs_02 }
  - { device: /dev/sde, name: ora_crs_03 }

ora_data:
  - { device: /dev/sdf, name: ora_data_01 }
  - { device: /dev/sdg, name: ora_data_02 }
  - { device: /dev/sdh, name: ora_data_03 }
  - { device: /dev/sdi, name: ora_data_04 }

ora_logs:
  - { device: /dev/sdj, name: ora_logs_01 }
  - { device: /dev/sdk, name: ora_logs_02 }

# Oracle RAC configuration

oracle_sid: NTAP
cluster_name: ntap-rac
cluster_nodes: ora01,ora02
cluster_domain: solutions.netapp.com
grid_cluster_nodes: ora01:ora01-vip:HUB,ora02:ora02-vip:HUB
network_interface_list: ens33:10.61.180.0:1,ens34:172.21.166.0:5
memory_limit: 10240

# Set initial password for all required Oracle passwords. Change them after installation.
initial_pwd_all: "XXXXXXXX"

....
. À partir du contrôleur Ansible, le kit d'outils d'automatisation cloné home Directory /home/admin/na_oracle_Deploy_rac, exécute le PlayBook des prérequis pour configurer les prérequis ansible.
+
[source, cli]
----
ansible-playbook -i hosts 1-ansible_requirements.yml
----
. Exécuter le manuel de configuration Linux.
+
[source, cli]
----
ansible-playbook -i hosts 2-linux_config.yml -u admin -e @vars/vars.yml
----
. Exécuter le PlayBook de déploiement Oracle
+
[source, cli]
----
ansible-playbook -i hosts 4-oracle_config.yml -u admin -e @vars/vars.yml
----
. Tous les playbooks ci-dessus peuvent également être exécutés à partir d'un seul PlayBook.
+
[source, cli]
----
ansible-playbook -i hosts 0-all_playbook.yml -u admin -e @vars/vars.yml
----


====


=== Validation du déploiement Oracle RAC dans VCF

[%collapsible]
====
Cette section fournit des détails sur la validation du déploiement d'Oracle RAC dans VCF pour garantir que toutes les ressources Oracle RAC sont entièrement déployées, configurées et fonctionnent comme prévu.

. Connectez-vous à RAC VM en tant qu'utilisateur administrateur pour valider l'infrastructure de grid Oracle.
+
....
[admin@ora01 ~]$ sudo su
[root@ora01 admin]# su - grid
[grid@ora01 ~]$ crsctl stat res -t
--------------------------------------------------------------------------------
Name           Target  State        Server                   State details
--------------------------------------------------------------------------------
Local Resources
--------------------------------------------------------------------------------
ora.LISTENER.lsnr
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.chad
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.net1.network
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.ons
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.proxy_advm
               OFFLINE OFFLINE      ora01                    STABLE
               OFFLINE OFFLINE      ora02                    STABLE
--------------------------------------------------------------------------------
Cluster Resources
--------------------------------------------------------------------------------
ora.ASMNET1LSNR_ASM.lsnr(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.DATA.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.LISTENER_SCAN1.lsnr
      1        ONLINE  ONLINE       ora01                    STABLE
ora.LISTENER_SCAN2.lsnr
      1        ONLINE  ONLINE       ora02                    STABLE
ora.LISTENER_SCAN3.lsnr
      1        ONLINE  ONLINE       ora02                    STABLE
ora.RECO.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.VOTE.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.asm(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    Started,STABLE
      2        ONLINE  ONLINE       ora02                    Started,STABLE
ora.asmnet1.asmnetwork(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.cvu
      1        ONLINE  ONLINE       ora02                    STABLE
ora.ntap.db
      1        ONLINE  ONLINE       ora01                    Open,HOME=/u01/app/o
                                                             racle2/product/19.0.
                                                             0/NTAP,STABLE
      2        ONLINE  ONLINE       ora02                    Open,HOME=/u01/app/o
                                                             racle2/product/19.0.
                                                             0/NTAP,STABLE
ora.ora01.vip
      1        ONLINE  ONLINE       ora01                    STABLE
ora.ora02.vip
      1        ONLINE  ONLINE       ora02                    STABLE
ora.qosmserver
      1        ONLINE  ONLINE       ora02                    STABLE
ora.scan1.vip
      1        ONLINE  ONLINE       ora01                    STABLE
ora.scan2.vip
      1        ONLINE  ONLINE       ora02                    STABLE
ora.scan3.vip
      1        ONLINE  ONLINE       ora02                    STABLE
--------------------------------------------------------------------------------
[grid@ora01 ~]$

....
. Valider Oracle ASM.
+
....
[grid@ora01 ~]$ asmcmd
ASMCMD> lsdg
State    Type    Rebal  Sector  Logical_Sector  Block       AU  Total_MB  Free_MB  Req_mir_free_MB  Usable_file_MB  Offline_disks  Voting_files  Name
MOUNTED  EXTERN  N         512             512   4096  1048576    163840   163723                0          163723              0             N  DATA/
MOUNTED  EXTERN  N         512             512   4096  1048576    163840   163729                0          163729              0             N  RECO/
MOUNTED  NORMAL  N         512             512   4096  4194304     30720    29732            10240            9746              0             Y  VOTE/
ASMCMD> lsdsk
Path
AFD:ORA_CRS_01
AFD:ORA_CRS_02
AFD:ORA_CRS_03
AFD:ORA_DATA_01
AFD:ORA_DATA_02
AFD:ORA_DATA_03
AFD:ORA_DATA_04
AFD:ORA_LOGS_01
AFD:ORA_LOGS_02
ASMCMD> afd_state
ASMCMD-9526: The AFD state is 'LOADED' and filtering is 'ENABLED' on host 'ora01'
ASMCMD>

....
. Répertorier les nœuds du cluster.
+
....

[grid@ora01 ~]$ olsnodes
ora01
ora02

....
. Valider OCR/VOTE.
+
....
[grid@ora01 ~]$ ocrcheck
Status of Oracle Cluster Registry is as follows :
         Version                  :          4
         Total space (kbytes)     :     901284
         Used space (kbytes)      :      84536
         Available space (kbytes) :     816748
         ID                       :  118267044
         Device/File Name         :      +VOTE
                                    Device/File integrity check succeeded

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

         Cluster registry integrity check succeeded

         Logical corruption check bypassed due to non-privileged user

[grid@ora01 ~]$ crsctl query css votedisk
##  STATE    File Universal Id                File Name Disk group
--  -----    -----------------                --------- ---------
 1. ONLINE   1ca3fcb0bd354f8ebf00ac97d70e0824 (AFD:ORA_CRS_01) [VOTE]
 2. ONLINE   708f84d505a54f58bf41124e09a5115a (AFD:ORA_CRS_02) [VOTE]
 3. ONLINE   133ecfcedb684fe6bfdc1899b90f91c7 (AFD:ORA_CRS_03) [VOTE]
Located 3 voting disk(s).
[grid@ora01 ~]$


....
. Validez l'écouteur Oracle.
+
....
[grid@ora01 ~]$ lsnrctl status listener

LSNRCTL for Linux: Version 19.0.0.0.0 - Production on 16-AUG-2024 10:21:38

Copyright (c) 1991, 2022, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=LISTENER)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 19.0.0.0.0 - Production
Start Date                14-AUG-2024 16:24:48
Uptime                    1 days 17 hr. 56 min. 49 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /u01/app/grid/19.0.0/network/admin/listener.ora
Listener Log File         /u01/app/oracle/diag/tnslsnr/ora01/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.21)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.93)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcps)(HOST=ora01.solutions.netapp.com)(PORT=5500))(Security=(my_wallet_directory=/u01/app/oracle2/product/19.0.0/NTAP/admin/NTAP/xdb_wallet))(Presentation=HTTP)(Session=RAW))
Services Summary...
Service "+ASM" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_DATA" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_RECO" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_VOTE" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "1fbf0aaa1d13cb5ae06315b43d0ab734.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "1fbf142e7db2d090e06315b43d0a6894.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "1fbf203c3a46d7bae06315b43d0ae055.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "NTAP.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "NTAPXDB.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb1.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb2.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb3.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
The command completed successfully
[grid@ora01 ~]$

[grid@ora01 ~]$ tnsping ntap-scan

TNS Ping Utility for Linux: Version 19.0.0.0.0 - Production on 16-AUG-2024 12:07:58

Copyright (c) 1997, 2022, Oracle.  All rights reserved.

Used parameter files:
/u01/app/grid/19.0.0/network/admin/sqlnet.ora

Used EZCONNECT adapter to resolve the alias
Attempting to contact (DESCRIPTION=(CONNECT_DATA=(SERVICE_NAME=))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.90)(PORT=1521))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.91)(PORT=1521))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.92)(PORT=1521)))
OK (10 msec)


....
. Passez à l'utilisateur oracle pour valider la base de données en cluster.
+
....
[oracle@ora02 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Fri Aug 16 11:32:23 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP      READ WRITE           ARCHIVELOG

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> select name from v$datafile
  2  union
  3  select name from v$controlfile
  4  union
  5  select member from v$logfile;

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/sysaux.275.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/system.274.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/undo_2.277.1177083853
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/undotbs1.273.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/users.278.1177083901
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/sysaux.281.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/system.280.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/undo_2.283.1177084061
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/undotbs1.279.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/users.284.1177084103
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/sysaux.287.1177084105

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/system.286.1177084105
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/undo_2.289.1177084123
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/undotbs1.285.1177084105
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/users.290.1177084125
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/sysaux.266.1177081837
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/system.265.1177081837
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/undotbs1.267.1177081837
+DATA/NTAP/CONTROLFILE/current.261.1177080403
+DATA/NTAP/DATAFILE/sysaux.258.1177080245
+DATA/NTAP/DATAFILE/system.257.1177080129
+DATA/NTAP/DATAFILE/undotbs1.259.1177080311

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/DATAFILE/undotbs2.269.1177082203
+DATA/NTAP/DATAFILE/users.260.1177080311
+DATA/NTAP/ONLINELOG/group_1.262.1177080427
+DATA/NTAP/ONLINELOG/group_2.263.1177080427
+DATA/NTAP/ONLINELOG/group_3.270.1177083297
+DATA/NTAP/ONLINELOG/group_4.271.1177083313
+RECO/NTAP/CONTROLFILE/current.256.1177080403
+RECO/NTAP/ONLINELOG/group_1.257.1177080427
+RECO/NTAP/ONLINELOG/group_2.258.1177080427
+RECO/NTAP/ONLINELOG/group_3.259.1177083313
+RECO/NTAP/ONLINELOG/group_4.260.1177083315

33 rows selected.


....
. Vous pouvez également vous connecter à EM Express pour valider la base de données RAC après l'exécution réussie du PlayBook.
+
image:vcf_orarac_vvol_em_01.png["Capture d'écran montrant la configuration d'Oracle EM Express."] image:vcf_orarac_vvol_em_02.png["Capture d'écran montrant la configuration d'Oracle EM Express."]



====


=== Sauvegarde et restauration de la base de données Oracle RAC dans VCF avec SnapCenter



==== Configuration SnapCenter

[%collapsible]
====
SnapCenter version 6 a de nombreuses améliorations de fonctionnalités par rapport à la version 5, y compris la prise en charge du datastore VMware vVols. SnapCenter s'appuie sur un plug-in côté hôte sur une VM de base de données pour effectuer des activités de gestion de la protection des données intégrant la cohérence applicative. Pour plus d'informations sur le plug-in NetApp SnapCenter pour Oracle, reportez-vous à cette documentation link:https://docs.netapp.com/us-en/snapcenter/protect-sco/concept_what_you_can_do_with_the_snapcenter_plug_in_for_oracle_database.html["Quelles sont les possibilités possibles grâce au plug-in pour Oracle Database"^]. Les étapes suivantes permettent de configurer SnapCenter version 6 pour la sauvegarde et la restauration de la base de données Oracle RAC dans VCF.

. Téléchargez la version 6 du logiciel SnapCenter sur le site de support NetApp : link:https://mysupport.netapp.com/site/downloads["Téléchargements de support NetApp"^].
. Connectez-vous à la machine virtuelle SnapCenter hébergeant Windows en tant qu'administrateur. Installer les prérequis pour SnapCenter 6.0.
+
image:vcf_ora_vvol_snapctr_prerequisites.png["Capture d'écran montrant les prérequis de SnapCenter 6.0."]

. En tant qu'administrateur, installez le JDK Java le plus récent à partir de link:https://www.java.com/en/["Obtenir Java pour les applications de bureau"^].
+

NOTE: Si le serveur Windows est déployé dans un environnement de domaine, ajoutez un utilisateur de domaine au groupe d'administrateurs locaux du serveur SnapCenter et exécutez l'installation SnapCenter avec l'utilisateur de domaine.

. Connectez-vous à l'interface utilisateur SnapCenter via le port HTTPS 8846 en tant qu'utilisateur d'installation pour configurer SnapCenter pour Oracle.
+
image:vcf_ora_vvol_snapctr_deploy_01.png["Capture d'écran montrant la configuration SnapCenter."]

. Consultez `Get Started` le menu pour vous mettre à niveau sur SnapCenter si vous êtes un nouvel utilisateur.
+
image:vcf_ora_vvol_snapctr_deploy_02.png["Capture d'écran montrant la configuration SnapCenter."]

. Mise à jour `Hypervisor Settings` dans les paramètres globaux.
+
image:aws_ora_fsx_vmc_snapctr_01.png["Capture d'écran montrant la configuration SnapCenter."]

. Ajoutez le cluster de stockage ONTAP à `Storage Systems` avec l'IP de gestion de cluster et authentifiez-vous via l'ID utilisateur de l'administrateur de cluster.
+
image:vcf_ora_vvol_snapctr_deploy_06.png["Capture d'écran montrant la configuration SnapCenter."] image:vcf_ora_vvol_snapctr_deploy_07.png["Capture d'écran montrant la configuration SnapCenter."]

. Ajoutez les machines virtuelles de base de données Oracle RAC et `Credential` la machine virtuelle du plug-in vSphere pour l'accès SnapCenter à la VM de base de données et à la machine virtuelle du plug-in vSphere. Les informations d'identification doivent avoir le privilège sudo sur les machines virtuelles Linux. Vous pouvez créer des informations d'identification différentes pour différents ID d'utilisateur de gestion pour les VM. L'ID utilisateur de gestion de VM du plug-in vShpere est défini lorsque la VM du plug-in est déployée dans vCenter.
+
image:aws_ora_fsx_vmc_snapctr_03.png["Capture d'écran montrant la configuration SnapCenter."]

. Ajoutez la VM de base de données Oracle RAC dans VCF à `Hosts` avec les informations d'identification VM de base de données créées à l'étape précédente.
+
image:vcf_orarac_vvol_snapctr_setup_01.png["Capture d'écran montrant la configuration SnapCenter."] image:vcf_orarac_vvol_snapctr_setup_02.png["Capture d'écran montrant la configuration SnapCenter."] image:vcf_orarac_vvol_snapctr_setup_03.png["Capture d'écran montrant la configuration SnapCenter."]

. De même, ajoutez la machine virtuelle du plug-in NetApp VMware à `Hosts` avec les informations d'identification de machine virtuelle du plug-in vSphere créées à l'étape précédente.
+
image:vcf_ora_vvol_snapctr_deploy_11.png["Capture d'écran montrant la configuration SnapCenter."] image:vcf_orarac_vvol_snapctr_setup_04.png["Capture d'écran montrant la configuration SnapCenter."]

. Enfin, une fois la base de données Oracle découverte sur la machine virtuelle de la base de données, revenir à `Settings`-`Policies` pour créer des règles de sauvegarde de la base de données Oracle. Dans l'idéal, créez une stratégie de sauvegarde de journal d'archivage distincte pour permettre des intervalles de sauvegarde plus fréquents afin de minimiser la perte de données en cas de panne.
+
image:aws_ora_fsx_vmc_snapctr_02.png["Capture d'écran montrant la configuration SnapCenter."]




NOTE: Assurez-vous que le nom du serveur SnapCenter peut être résolu sur l'adresse IP à partir de la VM DB et du plug-in vSphere. De même, le nom de la machine virtuelle de la base de données et le nom de la machine virtuelle du plug-in vSphere peuvent être résolus à l'adresse IP à partir du serveur SnapCenter.

====


==== Sauvegarde de la base de données

[%collapsible]
====
SnapCenter exploite les copies Snapshot de volume ONTAP pour accélérer considérablement la sauvegarde, la restauration ou le clonage de bases de données par rapport à la méthodologie RMAN traditionnelle. Les snapshots sont cohérents au niveau des applications, car la base de données est placée en mode de sauvegarde Oracle avant un snapshot.

. À partir du `Resources` Toutes les bases de données de la machine virtuelle sont découvertes automatiquement après l'ajout de la machine virtuelle à SnapCenter. Initialement, l'état de la base de données s'affiche comme `Not protected`.
+
image:vcf_orarac_vvol_snapctr_bkup_01.png["Capture d'écran montrant la configuration SnapCenter."]

. Cliquez sur base de données pour démarrer un flux de travail afin d'activer la protection de la base de données.
+
image:vcf_orarac_vvol_snapctr_bkup_02.png["Capture d'écran montrant la configuration SnapCenter."]

. Appliquez la stratégie de sauvegarde et configurez la planification si nécessaire.
+
image:vcf_orarac_vvol_snapctr_bkup_03.png["Capture d'écran montrant la configuration SnapCenter."]

. Configurez la notification de tâche de sauvegarde si nécessaire.
+
image:vcf_orarac_vvol_snapctr_bkup_05.png["Capture d'écran montrant la configuration SnapCenter."]

. Passez en revue le résumé et terminez pour activer la protection de la base de données.
+
image:vcf_orarac_vvol_snapctr_bkup_06.png["Capture d'écran montrant la configuration SnapCenter."]

. La procédure de sauvegarde à la demande peut être déclenchée en cliquant sur `Back up Now`.
+
image:vcf_orarac_vvol_snapctr_bkup_07.png["Capture d'écran montrant la configuration SnapCenter."] image:vcf_orarac_vvol_snapctr_bkup_08.png["Capture d'écran montrant la configuration SnapCenter."]

. La procédure de sauvegarde peut être surveillée sur le `Monitor` en cliquant sur le travail en cours.
+
image:vcf_orarac_vvol_snapctr_bkup_09.png["Capture d'écran montrant la configuration SnapCenter."]

. Cliquez sur base de données pour vérifier les jeux de sauvegarde terminés pour la base de données RAC.
+
image:vcf_ora_vvol_snapctr_bkup_10.png["Capture d'écran montrant la configuration SnapCenter."]



====


==== Restauration/récupération de la base de données

[%collapsible]
====
SnapCenter propose un certain nombre d'options de restauration pour la base de données RAC Oracle à partir d'une sauvegarde Snapshot. Dans cet exemple, nous démontrons que la restauration s'effectue à partir d'une ancienne sauvegarde de snapshot, puis que la base de données est repassée au dernier journal disponible.

. Tout d'abord, exécutez une sauvegarde de snapshot. Ensuite, créez une table de test et insérez une ligne dans la table pour valider la base de données récupérée à partir de l'image snapshot avant que la création de la table de test ne retrouve la table de test.
+
....
[oracle@ora01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Aug 19 10:31:12 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> alter session set container=ntap_pdb1;

Session altered.


SQL> create table test (id integer, dt timestamp, event varchar(100));

Table created.

SQL> insert into test values (1, sysdate, 'validate SnapCenter rac database restore on VMware vVols storage');

1 row created.

SQL> commit;

Commit complete.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
19-AUG-24 10.36.04.000000 AM
validate SnapCenter rac database restore on VMware vVols storage


SQL>

....
. Dans l'onglet SnapCenter `Resources` , ouvrez la page topologie de sauvegarde NTAP1 de la base de données. Mettez en avant le jeu de sauvegarde des données Snapshot créé il y a 3 jours. Cliquez sur `Restore` pour lancer le workflow de restauration/restauration.
+
image:vcf_orarac_vvol_snapctr_restore_01.png["Capture d'écran montrant la configuration SnapCenter."]

. Choisissez la portée de la restauration.
+
image:vcf_orarac_vvol_snapctr_restore_02.png["Capture d'écran montrant la configuration SnapCenter."]

. Choisissez étendue de récupération à `All Logs`.
+
image:vcf_orarac_vvol_snapctr_restore_03.png["Capture d'écran montrant la configuration SnapCenter."]

. Spécifiez les pré-scripts facultatifs à exécuter.
+
image:vcf_orarac_vvol_snapctr_restore_04.png["Capture d'écran montrant la configuration SnapCenter."]

. Spécifiez tout script après exécution facultatif.
+
image:vcf_orarac_vvol_snapctr_restore_05.png["Capture d'écran montrant la configuration SnapCenter."]

. Envoyez un rapport de travail si vous le souhaitez.
+
image:vcf_orarac_vvol_snapctr_restore_06.png["Capture d'écran montrant la configuration SnapCenter."]

. Passez en revue le résumé et cliquez sur `Finish` pour lancer la restauration et la récupération.
+
image:vcf_orarac_vvol_snapctr_restore_07.png["Capture d'écran montrant la configuration SnapCenter."]

. À partir de RAC DB VM ora01, vérifiez que la restauration/restauration de la base de données a abouti à son état le plus récent et a restauré la table de test créée 3 jours plus tard.
+
....

[root@ora01 ~]# su - oracle
[oracle@ora01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Aug 19 11:51:15 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode from v$database;

NAME      OPEN_MODE
--------- --------------------
NTAP      READ WRITE

SQL> sho pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> alter session set container=ntap_pdb1;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
19-AUG-24 10.36.04.000000 AM
validate SnapCenter rac database restore on VMware vVols storage

SQL> select current_timestamp from dual;

CURRENT_TIMESTAMP
---------------------------------------------------------------------------
19-AUG-24 11.55.20.079686 AM -04:00



SQL> exit
Disconnected from Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

....


Cette opération complète la démonstration de la sauvegarde, de la restauration et de la restauration SnapCenter de la base de données RAC Oracle dans VCF avec vVols.

====


== Où trouver des informations complémentaires

Pour en savoir plus sur les informations fournies dans ce document, consultez ces documents et/ou sites web :

* link:https://www.vmware.com/products/cloud-infrastructure/vmware-cloud-foundation["Socle cloud VMware"^]
* link:index.html["Solutions NetApp pour bases de données d'entreprise"^]
* link:https://docs.netapp.com/us-en/snapcenter/concept/concept_snapcenter_overview.html["Logiciel SnapCenter 6.0"^]
* link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["Documentation sur les outils ONTAP pour VMware vSphere"^]

