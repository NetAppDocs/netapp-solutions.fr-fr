---
sidebar: sidebar 
permalink: databases/azure_ora_nfile_protection.html 
summary: 'Cette section décrit comment protéger votre base de données Oracle avec l"outil azacsnap et le Tiering de sauvegarde, de restauration et de snapshots vers Azure Blob.' 
keywords: Oracle, Azure, database, backup, restore 
---
= Protégez votre base de données Oracle dans le cloud Azure
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:table-stripes: odd
:imagesdir: ./../media/


link:azure_ora_nfile_procedures.html["Précédent : procédures de déploiement."]

[role="lead"]
Auteur(s) : Allen Cao, ingénierie des solutions NetApp



== Sauvegardez la base de données Oracle avec snapshot à l'aide de l'outil AzAcSnap

L'outil Azure application-cohérent Snapshot Tool (AzAcSnap) est un outil de ligne de commande qui permet de protéger les données des bases de données tierces en gérant l'orchestration nécessaire pour les placer dans un état cohérent entre les applications avant de créer une copie Snapshot de stockage. Il renvoie ensuite les bases de données à un état opérationnel.

Dans le cas d'Oracle, vous mettez la base de données en mode de sauvegarde pour prendre un instantané, puis sortez-la du mode de sauvegarde.



=== Sauvegarde des données et des volumes de journaux

La sauvegarde peut être configurée sur l'hôte du serveur de base de données à l'aide d'un script shell simple qui exécute la commande snapshot. Ensuite, le script peut être planifié pour s'exécuter à partir de crontab.

Généralement, la fréquence de sauvegarde dépend des objectifs RTO et RPO souhaités. La création fréquente de snapshots consomme plus d'espace de stockage. Il existe un compromis entre la fréquence de sauvegarde et la consommation d'espace.

En général, les volumes de données consomment plus d'espace de stockage que les volumes de journaux. Ainsi, vous pouvez créer des snapshots sur des volumes de données toutes les quelques heures et plus fréquemment sur les volumes des journaux toutes les 15 à 30 minutes.

Reportez-vous aux exemples suivants de scripts de sauvegarde et de planification.

Pour les copies Snapshot de volumes de données :

[source, cli]
----
 # /bin/sh
cd /home/azacsnap/bin
. ~/.bash_profile
azacsnap -c backup --volume data --prefix acao-ora01-data --retention 36
azacsnap -c backup --volume other --prefix acao-ora01-log --retention 250
----
Pour les instantanés de volume de journal :

[source, cli]
----
 # /bin/sh
cd /home/azacsnap/bin
. ~/.bash_profile
azacsnap -c backup --volume other --prefix acao-ora01-log --retention 250
----
68b7e37ef318c0e56eabf3e1aded4216


NOTE: Lors de la configuration de la sauvegarde `azacsnap.json` fichier de configuration, ajoutez tous les volumes de données, y compris le volume binaire, à `dataVolume` et tous les volumes de log à `otherVolume`. La rétention maximale des snapshots est de 250 copies.



=== Validation des snapshots

Accédez au portail Azure > Azure NetApp Files/volumes pour vérifier si les snapshots ont été créés.

image:db_ora_azure_anf_snap_01.PNG["Cette capture d'écran illustre deux fichiers dans la liste de snapshot."]
image:db_ora_azure_anf_snap_02.PNG["Cette capture d'écran illustre huit fichiers dans la liste de capture d'écran."]



== Restauration et restauration Oracle à partir de la sauvegarde locale

L'un des principaux avantages de la sauvegarde Snapshot est sa coexistence avec les volumes de base de données source, et les volumes de base de données primaires peuvent être redéployés presque instantanément.



=== Restauration et restauration d'Oracle sur le serveur principal

L'exemple suivant montre comment restaurer et récupérer une base de données Oracle à partir du tableau de bord et de l'interface de ligne de commande Azure sur le même hôte Oracle.

. aa30a622663e0f34541394e008fe82cd
+
ea16560565f3889db4dabf938628b462

+
Copyright (c) 1982, 2019, Oracle. Tous droits réservés.

+
Connecté à : Oracle Database 19c Enterprise Edition version 19.0.0.0.0 - production version 19.8.0.0.0

+
0409b2fce118cc126a532dea158d2943

+
bec6da77877c0793c1d3eb6c6896e98e

+
a5b83945adfd5370663cb2d9c4f31d09

+
6ba18fa8fa7d170dfd8fc80f0f3d39f7

+
d1d2dcb121f8bf8fd39724ea075c6409

+
a92090dde5e820fde0a68705ee3f2bd0

+
fd9736dfc88a182f9cb6e5f6a2b97487

+
 ID
+
[listing]
----
EVENT
--------------------------------------------------------------------------------
DT
---------------------------------------------------------------------------
         1
insert a data marker to validate snapshot restore
12-SEP-22 07.07.35.000000 PM
----
. Déposez le tableau après les sauvegardes de snapshot.
+
07b56c53a9fec8c477afb0cb5f2394af

+
dcd4d50ecf59b4752c161f0ddc44df44

+
Copyright (c) 1982, 2019, Oracle. Tous droits réservés.

+
Connecté à : Oracle Database 19c Enterprise Edition version 19.0.0.0.0 - production version 19.8.0.0.0

+
bee0f13528c2f6f5b67053dc1e942328

+
cd85f26775e453b2177d5fcc6265b31d

+
07e18ec921a195478cdbab47d8d68d89

+
f06f4fbf6e3e0e45b0d4b241ceaf19c9

. Depuis le tableau de bord Azure NetApp Files, restaurez le volume des journaux vers le dernier snapshot disponible. Choisissez *Revert volume*.
+
image:db_ora_azure_anf_restore_01.PNG["Cette capture d'écran montre la méthode de reversion de snapshot pour les volumes du tableau de bord ANF."]

. Confirmez la restauration du volume et cliquez sur *Revert* pour terminer la réversion du volume vers la dernière sauvegarde disponible.
+
image:db_ora_azure_anf_restore_02.PNG["« Êtes-vous sûr de vouloir le faire ? » page pour la nouvelle version de snapshot."]

. Répétez les mêmes étapes pour le volume de données, puis assurez-vous que la sauvegarde contient la table à restaurer.
+
image:db_ora_azure_anf_restore_03.PNG["Cette capture d'écran montre la méthode de reversion de snapshot pour les volumes de données dans le tableau de bord ANF."]

. Confirmez de nouveau la version du volume et cliquez sur « Revert ».
+
image:db_ora_azure_anf_restore_04.PNG["« Êtes-vous sûr de vouloir le faire ? » page pour la nouvelle version du snapshot du volume de données."]

. Resynchroniser les fichiers de contrôle si vous disposez de plusieurs copies d'entre eux et remplacer l'ancien fichier de contrôle par la dernière copie disponible.
+
952cd3804f479f3c31f123d064ccbdf5

. Connectez-vous à la machine virtuelle Oracle Server et exécutez la restauration de la base de données avec sqlplus.
+
07b56c53a9fec8c477afb0cb5f2394af

+
125ab5cbfb90c4a6d038bcca4da6fdc4

+
Copyright (c) 1982, 2019, Oracle. Tous droits réservés.

+
010621501012cd31b6666d17dad683d2

+
6bd3f70e5ab38ca26f8cabd390e15fc0

+
424459a4363a5afdd1e45d31fcd11efe

+
db9afd3f7adaff3fe1135208fa6b6a09

+
abc467423916c8ee7c16f566b4ab4ca8

+
db9afd3f7adaff3fe1135208fa6b6a09

+
479d2dfa77fdcde3bfd41fcdebbca1ff

+
db9afd3f7adaff3fe1135208fa6b6a09

+
c76ff2f7e10a42adf7faec8f9e6faeab

+
0e98028493ec8c4a1d181c0d71c3ec7b

+
f6c9ea366c01da7d664a8c7c3813e0bd

+
fd9736dfc88a182f9cb6e5f6a2b97487

+
 ID
+
[listing]
----
EVENT
--------------------------------------------------------------------------------
DT
---------------------------------------------------------------------------
         1
insert a data marker to validate snapshot restore
12-SEP-22 07.07.35.000000 PM


SQL> select systimestamp from dual;

 SYSTIMESTAMP
---------------------------------------------------------------------------
13-SEP-22 03.28.52.646977 PM +00:00
----


Cet écran montre que la table supprimée a été restaurée à l'aide de sauvegardes instantanées locales.

link:azure_ora_nfile_migration.html["Suivant : migration de base de données."]
